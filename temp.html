<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Social Norms in Climate Discussions</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html{background:#0a1628}
body{font-family:"Inter","Segoe UI",system-ui,sans-serif;background:#0a1628;color:#e0e0e0;padding:15px 20px}
h1{text-align:center;font-size:1.3em;color:#fff;margin-bottom:2px;font-weight:300;letter-spacing:2px}
.subtitle{text-align:center;color:#6a8caf;font-size:0.78em;margin-bottom:18px}
/* Tabs with grouped structure */
.tabs{display:flex;gap:2px;margin-bottom:0;flex-wrap:wrap;justify-content:center;align-items:end}
.tab-btn{padding:7px 14px;cursor:pointer;border:none;background:#12203a;color:#6a8caf;font-size:0.78em;border-radius:8px 8px 0 0;transition:all 0.3s;font-family:inherit;font-weight:500}
.tab-btn:hover{background:#1a3050;color:#a0c4e8}
.tab-btn.active{background:#1a3050;color:#fff;border-bottom:2px solid #5ab4ac}
.tab-sep{width:1px;height:20px;background:#1a3050;margin:0 4px;align-self:center}
.tab-content{display:none;background:#0f1d33;border-radius:0 8px 8px 8px;padding:20px;min-height:400px}
.tab-content.active{display:block}
.sec{background:#12203a;border-radius:10px;padding:16px;border:1px solid #1a3050;position:relative}
.sec:hover{border-color:#2a4060}
.sec-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.sec-title{font-size:0.95em;color:#fff;font-weight:400}
.info-btn{width:20px;height:20px;border-radius:50%;border:1px solid #3a5a7a;background:none;color:#5a8aaf;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:serif;font-style:italic;flex-shrink:0;transition:all 0.2s}
.info-btn:hover{background:#1a3050;color:#fff;border-color:#5ab4ac}
.info-popup{display:none;position:absolute;top:40px;right:10px;background:#1a3050;border:1px solid #2a4060;border-radius:8px;padding:12px 14px;font-size:0.78em;color:#b0c4d8;line-height:1.5;max-width:350px;z-index:10;box-shadow:0 4px 20px rgba(0,0,0,0.5)}
.info-popup.show{display:block}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.full{grid-column:1/-1}
.gauge-clip{height:220px;overflow:hidden;position:relative}
.bubble-chart{width:100%;height:300px}
.bubble-chart svg{width:100%;height:100%}
.bubble-label{fill:#fff;font-family:Inter,sans-serif;pointer-events:none;text-anchor:middle}
.bubble-sector-label{fill:#6a8caf;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px}
.sankey-toggles{display:flex;gap:6px;margin-bottom:8px;justify-content:flex-start}
.sankey-toggle{padding:5px 14px;border:1px solid #2a4060;border-radius:14px;background:none;color:#6a8caf;font-size:0.75em;cursor:pointer;font-family:inherit;transition:all 0.2s}
.sankey-toggle:hover{border-color:#5ab4ac;color:#b0c4d8}
.sankey-toggle.active{background:#1a3050;border-color:#5ab4ac;color:#fff}
.legend{display:flex;gap:12px;justify-content:center;margin-top:6px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:4px;font-size:0.75em;color:#b0c4d8}
.legend-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
/* Animations */
@keyframes fadeSlideUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.85)}to{opacity:1;transform:scale(1)}}
.sec{animation:fadeSlideUp 0.5s ease-out both}
.tab-content.active .sec{animation:fadeSlideUp 0.5s ease-out both}
.stat-box{animation:scaleIn 0.4s ease-out both}
.ex-section{animation:fadeSlideUp 0.4s ease-out both}
/* Stat boxes */
.stat-grid{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:15px 0}
.stat-box{background:#12203a;padding:10px 16px;border-radius:8px;text-align:center;min-width:80px}
.stat-val{font-size:1.3em;font-weight:600}
.stat-label{font-size:0.65em;color:#6a8caf;margin-top:2px}
/* Examples */
.ex-section{margin-bottom:8px}
.ex-section summary{cursor:pointer;padding:8px 12px;background:#12203a;border-radius:6px;font-size:0.9em;color:#b0c4d8;list-style:none}
.ex-section summary::-webkit-details-marker{display:none}
.ex-section summary::before{content:"\25B6 ";font-size:0.7em;color:#5ab4ac}
.ex-section[open] summary::before{content:"\25BC ";font-size:0.7em;color:#5ab4ac}
.ex-content{padding:8px 0 8px 12px}
.ex-group-title{font-size:0.8em;font-weight:600;margin:8px 0 4px;padding-left:4px}
.ex-card{background:#0a1628;border-radius:6px;padding:10px 12px;margin-bottom:6px;font-size:0.8em;line-height:1.4}
.ex-card.mismatch{border-left:3px solid #ff9aa8}
.ex-card.match{border-left:3px solid #8fcc8f}
.ex-comment{color:#c0d0e0;margin-bottom:6px;white-space:pre-wrap}
.ex-labels{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.ex-tag{background:#1a2a40;padding:2px 8px;border-radius:10px;font-size:0.85em;color:#b0c4d8}
.ex-tag.reason{background:#2a1a30;color:#c49fc4}
.ex-sector{font-size:0.75em;color:#4a6a8a;margin-left:auto}
</style>
</head>
<body>
<h1>SOCIAL NORMS IN CLIMATE DISCUSSIONS</h1>
<p class="subtitle">Reddit analysis across Food, Transport &amp; Housing &mdash; 9,000 comments &mdash; LLM-labeled with verification</p>

<div class="tabs">
<button class="tab-btn active" onclick="showTab('norms')">Norms</button>
<button class="tab-btn" onclick="showTab('author-stance')">Author Stance</button>
<span class="tab-sep"></span>
<button class="tab-btn" onclick="showTab('survey')">Factors &amp; Barriers</button>
<span class="tab-sep"></span>
<button class="tab-btn" onclick="showTab('temporal')">Temporal</button>
<span class="tab-sep"></span>
<button class="tab-btn" onclick="showTab('verification')">Verification</button>
<button class="tab-btn" onclick="showTab('examples')">Examples</button>
</div>

<!-- TAB 1: NORMS (presence + dimensions + reference groups) -->
<div class="tab-content active" id="tab-norms">
<div class="sec">
<div class="sec-header">
<div class="sec-title">Does the comment reference a social norm?</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Gate question (1.1): Each comment is first classified as containing a social norm or not. A social norm is any reference to what people do (descriptive) or should do (injunctive) regarding climate actions. Food discussions contain norms most often (40%), while transport/housing are lower.</div>
<div class="gauge-clip"><div id="gauge-chart"></div></div>
<div style="text-align:center;margin-top:6px">
<span style="color:#5ab4ac;font-size:0.85em">&#9679; Food 40.2%</span> &nbsp;
<span style="color:#af8dc3;font-size:0.85em">&#9679; Transport 11.6%</span> &nbsp;
<span style="color:#f4a460;font-size:0.85em">&#9679; Housing 16.2%</span>
</div>
</div>
<div class="sec" style="margin-top:16px">
<div class="sec-header">
<div class="sec-title">Norm Classification Flow</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Each comment is classified across 4 norm dimensions. Select a sector to trace its 3,000 comments through each dimension. <b>Descriptive</b>: what people do. <b>Injunctive</b>: what people should do. <b>Second-order</b>: beliefs about others' beliefs. <b>Perceived stance</b>: what reference groups think.</div>
<div class="sankey-toggles">
<button class="sankey-toggle active" data-sec="Food" onclick="window._sankeySetSector('Food')">Food</button>
<button class="sankey-toggle" data-sec="Transport" onclick="window._sankeySetSector('Transport')">Transport</button>
<button class="sankey-toggle" data-sec="Housing" onclick="window._sankeySetSector('Housing')">Housing</button>
<button class="sankey-toggle" data-sec="all" onclick="window._sankeySetSector('all')">All Sectors</button>
</div>
<div id="sankey-norms"></div>
</div>
<div class="sec" style="margin-top:16px">
<div class="sec-header">
<div class="sec-title">Reference Groups Mentioned</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Which social groups does the speaker reference when discussing climate actions? Shows the count of mentions per reference group category across sectors. Size = frequency of mention.</div>
<div id="bubble-pack" class="bubble-chart"></div>
<div class="legend" id="bubble-legend"></div>
</div>
</div>

<!-- TAB 3: AUTHOR STANCE -->
<div class="tab-content" id="tab-author-stance">
<div class="sec">
<div class="sec-header">
<div class="sec-title">Author Stance Toward Climate Action</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">How does the comment author position themselves toward the climate action (veganism, EVs, solar)? Pro = supportive, Against = opposed, Against particular but pro = criticizes specifics but supports overall, Neither/Mixed = neutral or ambivalent, Pro but lack of options = wants to but faces barriers.</div>
<div id="treemap-stance-main"></div>
</div>
</div>

<!-- TAB 4: FACTORS & BARRIERS -->
<div class="tab-content" id="tab-survey">
<div class="sec">
<div class="sec-header">
<div class="sec-title">Attitude &amp; Barrier Factors by Sector</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Each comment is also labeled against sector-specific survey questions about attitudes, barriers, and behavioral factors. Shows % of comments where the factor is present. Food has 13 factors, Transport 6, Housing 10.</div>
<div style="display:flex;justify-content:center;gap:0;flex-wrap:wrap">
<div style="flex:1;min-width:280px"><div style="text-align:center;color:#5ab4ac;font-size:0.85em;font-weight:600;letter-spacing:1px;margin-bottom:4px">FOOD</div><svg id="radial-food" viewBox="0 0 460 430" style="width:100%;max-width:460px;display:block;margin:auto"></svg></div>
<div style="flex:1;min-width:280px"><div style="text-align:center;color:#af8dc3;font-size:0.85em;font-weight:600;letter-spacing:1px;margin-bottom:4px">TRANSPORT</div><svg id="radial-transport" viewBox="0 0 460 430" style="width:100%;max-width:460px;display:block;margin:auto"></svg></div>
<div style="flex:1;min-width:280px"><div style="text-align:center;color:#f4a460;font-size:0.85em;font-weight:600;letter-spacing:1px;margin-bottom:4px">HOUSING</div><svg id="radial-housing" viewBox="0 0 460 430" style="width:100%;max-width:460px;display:block;margin:auto"></svg></div>
</div>
</div>
</div>

<!-- TAB: TEMPORAL TRENDS -->
<div class="tab-content" id="tab-temporal">
<div class="sec">
<div class="sec-header">
<div class="sec-title">Author Stance Over Time (% by year)</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Proportions of author stance categories per year within each sector. Shows how climate action support/opposition evolves from 2010-2024. Each column sums to 100%.</div>
<div class="grid3">
<div><div style="text-align:center;color:#5ab4ac;font-size:0.8em;font-weight:600;margin-bottom:2px">FOOD</div><div id="temporal-stance-food"></div></div>
<div><div style="text-align:center;color:#af8dc3;font-size:0.8em;font-weight:600;margin-bottom:2px">TRANSPORT</div><div id="temporal-stance-transport"></div></div>
<div><div style="text-align:center;color:#f4a460;font-size:0.8em;font-weight:600;margin-bottom:2px">HOUSING</div><div id="temporal-stance-housing"></div></div>
</div>
</div>
<div class="sec" style="margin-top:16px">
<div class="sec-header">
<div class="sec-title">Norm Dimensions Over Time (% by year)</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">How the distribution of norm classifications (descriptive, injunctive, second-order, perceived stance) changes across years. Each stacked area shows proportions within a single dimension.</div>
<div class="temporal-dim-toggles" style="display:flex;gap:6px;margin-bottom:10px;justify-content:flex-start">
<button class="sankey-toggle active" data-dim="1.2.1_descriptive" onclick="window._setTemporalDim(this.dataset.dim)">Descriptive</button>
<button class="sankey-toggle" data-dim="1.2.2_injunctive" onclick="window._setTemporalDim(this.dataset.dim)">Injunctive</button>
<button class="sankey-toggle" data-dim="1.3.3_second_order" onclick="window._setTemporalDim(this.dataset.dim)">Second-Order</button>
<button class="sankey-toggle" data-dim="1.3.1b_perceived_reference_stance" onclick="window._setTemporalDim(this.dataset.dim)">Perceived Stance</button>
</div>
<div class="grid3">
<div><div style="text-align:center;color:#5ab4ac;font-size:0.8em;font-weight:600;margin-bottom:2px">FOOD</div><div id="temporal-dim-food"></div></div>
<div><div style="text-align:center;color:#af8dc3;font-size:0.8em;font-weight:600;margin-bottom:2px">TRANSPORT</div><div id="temporal-dim-transport"></div></div>
<div><div style="text-align:center;color:#f4a460;font-size:0.8em;font-weight:600;margin-bottom:2px">HOUSING</div><div id="temporal-dim-housing"></div></div>
</div>
</div>
<div class="sec" style="margin-top:16px">
<div class="sec-header">
<div class="sec-title">Survey Factors Over Time (% yes by year)</div>
<button class="info-btn" onclick="toggleInfo(this)">?</button>
</div>
<div class="info-popup">Proportion of comments matching each survey question factor per year. Food has 13 factors, Transport 6, Housing 10. Stacked areas show how these behavioral/attitudinal factors evolve over time.</div>
<div class="grid3">
<div><div style="text-align:center;color:#5ab4ac;font-size:0.8em;font-weight:600;margin-bottom:2px">FOOD</div><div id="temporal-survey-food"></div></div>
<div><div style="text-align:center;color:#af8dc3;font-size:0.8em;font-weight:600;margin-bottom:2px">TRANSPORT</div><div id="temporal-survey-transport"></div></div>
<div><div style="text-align:center;color:#f4a460;font-size:0.8em;font-weight:600;margin-bottom:2px">HOUSING</div><div id="temporal-survey-housing"></div></div>
</div>
</div>
</div>

<!-- TAB 5: VERIFICATION -->
<div class="tab-content" id="tab-verification">
<div class="sec" style="padding:10px 16px">
<div class="sec-header"><div class="sec-title" style="font-size:0.85em">Model Verification: Fast (Mistral-7B) vs Reasoning (GPT-oss-20B)</div><button class="info-btn" onclick="toggleInfo(this)">?</button></div>
<div class="info-popup">50 samples per question re-labeled with a slower reasoning model. Accuracy = agreement rate. Cohen's kappa accounts for chance agreement. Confidence = model's logprob-derived certainty.</div>
</div>
<div class="stat-grid">
<div class="stat-box"><div class="stat-val" style="color:#8fcc8f">86.1%</div><div class="stat-label">Accuracy</div></div><div class="stat-box"><div class="stat-val" style="color:#ff9aa8">0.32</div><div class="stat-label">Cohen's k</div></div><div class="stat-box"><div class="stat-val" style="color:#8fcc8f">0.0%</div><div class="stat-label">No Response</div></div><div class="stat-box"><div class="stat-val" style="color:#b0c4d8">1800</div><div class="stat-label">Total Samples</div></div><div class="stat-box"><div class="stat-val" style="color:#8fcc8f">0.954</div><div class="stat-label">Conf (Match)</div></div><div class="stat-box"><div class="stat-val" style="color:#ffb87a">0.880</div><div class="stat-label">Conf (Mismatch)</div></div><div class="stat-box"><div class="stat-val" style="color:#8fcc8f">92.1%</div><div class="stat-label">Acc (Conf>0.9)</div></div><div class="stat-box"><div class="stat-val" style="color:#b0c4d8">1343</div><div class="stat-label">High-Conf Samples</div></div>
</div>
<div class="grid2">
<div class="sec"><div class="sec-title" style="font-size:0.85em;margin-bottom:8px">Accuracy by Question</div><div id="chart-acc"></div></div>
<div class="sec"><div class="sec-title" style="font-size:0.85em;margin-bottom:8px">Top Estimation Errors</div><div id="chart-est"></div></div>
<div class="sec"><div class="sec-title" style="font-size:0.85em;margin-bottom:8px">Confidence vs Mismatch</div><div id="chart-conf-box"></div><div id="chart-conf-scatter"></div></div>
<div class="sec"><div class="sec-title" style="font-size:0.85em;margin-bottom:8px">Accuracy (Conf &gt; 0.9)</div><div id="chart-hc-acc"></div></div>
</div>
</div>

<!-- TAB 6: EXAMPLES -->
<div class="tab-content" id="tab-examples">
<div style="margin-bottom:12px;color:#6a8caf;font-size:0.82em">
Verification examples from 50 samples per question. <span style="color:#8fcc8f">Green</span> = models agree. <span style="color:#ff9aa8">Red</span> = models disagree.
Lowest-accuracy questions are expanded by default.
</div>
<details class="ex-section" >
<summary><span style="color:#ffb87a;font-weight:700;">82%</span> Norm signal present (gate) <span style="color:#4a6a8a;font-size:0.8em;">(1.1_gate)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">41 matches, 9 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">You can’t take up a supercharger while charged, you’ll be hit with idle fees regardless of whether you have free charging or not. Given how fast superchargers charge, it seems likely they couldn’t shop without running the risk of being full too soon.</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>0</b></span>
<span class="ex-tag reason">Reasoning: <b>1</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Calling it a "cause" makes it sound like it is a bunch of people like über-Christians ("That child needs Jesus!" "Amen sister, lets give him Jesus!"), but as über-vegans trying to shove a vegan lifestyle down everyone's throats. Just sayin. Another t...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>0</b></span>
<span class="ex-tag reason">Reasoning: <b>1</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">I haven't had them for a full year yet.  I had them installed in November, so the initial generation was during the winter (the weakest time for solar).  They didn't cover the bill at the time, since I had not built up credit hours in the summer.  Th...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>1</b></span>
<span class="ex-tag reason">Reasoning: <b>0</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">These Sorels are vegan. I emailed the company and they confirmed: http://www.sorel.com/womens-tofino-organza-boot-1553971.html
I'm waiting on buying them because they don't have a super long return policy and I want to see if any reviews come out fir...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>1</b></span>
<span class="ex-tag reason">Reasoning: <b>0</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">So your source for how Model 3 hurt 3 series sales is a a document describing how 3 series sales actually \*improved\*? The second one is pointless as that is no indication if they actually were in the market for a new 3 series car or not.</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>0</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card match">
<div class="ex-comment">Agreed, my office has about [6 charging stations installed](http://i.imgur.com/ZbRx6J4.jpg), and the golf carts use standard 110, so I could charge either way.

Just plugging a car into 110v is nothing for the company but good PR.  I bet they let you...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>0</b></span>
<span class="ex-sector">transport</span></div></div>
</div></details>
<details class="ex-section" open>
<summary><span style="color:#ff9aa8;font-weight:700;">58%</span> Author stance <span style="color:#4a6a8a;font-size:0.8em;">(1.1.1_stance)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">29 matches, 21 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">But you see, it would have no real flaw if it had a 200 kWh battery pack and it performed like a NIO EP9 for example. To expect McLaren to become leaders with performance EVs was unreasonable, they have no product displaying amazing electric performa...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>neither/mixed</b></span>
<span class="ex-tag reason">Reasoning: <b>against particular but pro</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">&amp;gt; Well you're never 'going solar', anyway. Virtually all residential solar in cities will be such that the power you generate goes to the grid, and the power you use comes from the grid. In other words, you're not 'going solar', you're using exact...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>neither/mixed</b></span>
<span class="ex-tag reason">Reasoning: <b>against</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">i am not vegan for animal cruelty reasons. in my opinion that ranks as the worst reason to be vegan (here come the downvotes).

there are 2 much more important reasons why myself and everybody else should be vegan: our health, and our environment. 
t...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>pro but lack of options</b></span>
<span class="ex-tag reason">Reasoning: <b>pro</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">&amp;gt;What's your proposal, ditch cars all together?

Did I say that?  The topic is about the F-150 Lightning, which uses a 125-175 kWh battery pack.  2-3x larger than a more reasonable EV sedan.  It's not the car we should consider being the best choi...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>pro but lack of options</b></span>
<span class="ex-tag reason">Reasoning: <b>pro</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">Wow. I am sorry for not responding immediately. Pff. As if you made a comment that is so genius I couldn’t respond.

&amp;gt;alt right

Ah, let’s get nazism involved. 

Anyway. The cost of doing nothing worldwide is of course in the long run more expensi...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>neither/mixed</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card match">
<div class="ex-comment">If you don't own land, I can't just invest the money in a stationary array.  But further, even talking about a home owner adding roof solar, the cost of initial investment isn't just the panels, but also the inverters and controllers that are needed....</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>pro</b></span>
<span class="ex-sector">transport</span></div></div>
</div></details>
<details class="ex-section" open>
<summary><span style="color:#ff9aa8;font-weight:700;">60%</span> Descriptive norm <span style="color:#4a6a8a;font-size:0.8em;">(1.2.1_descriptive)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">30 matches, 20 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">I've been on the fence about the different options for funding of the system. Here is a link to a local paper that warns about HERO. http://www.pe.com/articles/hero-758344-program-home.html
I'm of the mind that the solar companies are inflating their...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>unclear</b></span>
<span class="ex-tag reason">Reasoning: <b>absent</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Coconut milk ice cream has the same aftertaste issue. Had some vegan froyo yesterday that was pretty damned good though.</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>unclear</b></span>
<span class="ex-tag reason">Reasoning: <b>explicitly present</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Gonna agree with the sub on this one, y’all had me with the buying from breeder stuff over adopting from a shelter, that is gross, but it is dangerous and irresponsible to give your dog a vegan diet lol</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>unclear</b></span>
<span class="ex-tag reason">Reasoning: <b>absent</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">I got a quote from Longhorn for a 4.486kw system for $1.82/w or $11,575 after Federal tax credit.  There are no other incentives in Leander.  This was in Williamson County using Perdenales Electrical Co-op, with a composite shingle, two-story house b...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>absent</b></span>
<span class="ex-tag reason">Reasoning: <b>explicitly present</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">As much as I dislike musk, I have to admit that this car is fuckin sick.

Big props to Tesla on this one!</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>absent</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card match">
<div class="ex-comment">And from the excess wear that comes from EVs which are generally heavier than ICEs in the same class.</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>absent</b></span>
<span class="ex-sector">transport</span></div></div>
</div></details>
<details class="ex-section" >
<summary><span style="color:#ffb87a;font-weight:700;">78%</span> Injunctive norm <span style="color:#4a6a8a;font-size:0.8em;">(1.2.2_injunctive)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">39 matches, 11 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">your ED most likely attributed to this(not enogub nutrients), but it's true, bleeding does too. but supplements are the answer! meat won't do this if youre anemic. i'm low on iron too due to my mum being anemic when i was in her tummy plus being a bl...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>absent</b></span>
<span class="ex-tag reason">Reasoning: <b>present</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Whether or not you realize it, you're asking for a heavy subsidy. 

To even swap kilowatts 1-to-1 is a subsidy, because it gives the panels free use of the distribution network, and doesn't include any reserves for maintenance or capital expansion --...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>absent</b></span>
<span class="ex-tag reason">Reasoning: <b>present</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">it is our step by step guide with shopping list, when to start cooking, how to set up a compassionate &amp;amp; healthy vegan thanksgiving = thanksliving.  Our video about it is up to 16k views &amp;amp; we only started youtube a few months ago https://www.y...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>absent</b></span>
<span class="ex-tag reason">Reasoning: <b>present</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">I think monks would be prime candidates for being vegans too...no need to worry about armour that contains leather (even plate mail has straps and buckles)...interestingly, though, the "Vow of Purity" I mentioned in the original post is a prerequisit...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>absent</b></span>
<span class="ex-tag reason">Reasoning: <b>present</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">By "others" do you mean the people who raid  the vegan subreddit to whine about people supporting veganism in the vegan subreddit?</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>absent</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card match">
<div class="ex-comment">Those look like 400w panels, trying to guess size.. if so they can be purchased for about $200/per x 20 = $4,000.00 check facebook marketplace (I am finding them new even cheaper), grid tied 10kw inverter w/o batteries $3,000-4,000.00, wire and frame...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>absent</b></span>
<span class="ex-sector">transport</span></div></div>
</div></details>
<details class="ex-section" >
<summary><span style="color:#ffb87a;font-weight:700;">80%</span> Reference group <span style="color:#4a6a8a;font-size:0.8em;">(1.3.1_reference_group)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">40 matches, 10 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">&amp;gt;It sounds like the issue is that he didn't know this feature existed because it's unlike how any other car on the road does it. In fact, didn't they add this button feature after the car was already produced, in that they didn't even consider thi...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>other reddit user</b></span>
<span class="ex-tag reason">Reasoning: <b>other</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Thanks for the picture!

Is there anything special about the feed through panel?

Does this get a pass because the gateway is not on a breaker and is considered an "extension" of the bus?

Just trying to understand this a bit more so I can explain it...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>coworkers</b></span>
<span class="ex-tag reason">Reasoning: <b>other</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">As GM creates Global Electric Vehicle Program role, we have some suggestions</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>other reddit user</b></span>
<span class="ex-tag reason">Reasoning: <b>other</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">I've thought about this before.  I am vegan, my S.O isn't.  I already told him that I want vegan food served at my wedding.  I don't care if it's fancy or it no one comes.  I want it to be tasty, and if my family eats before hand, so be it.  I'll mak...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>friends</b></span>
<span class="ex-tag reason">Reasoning: <b>partner/spouse</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">If you want to get historical. There's strong evidence Leonardo da Vinci was vegan, he was definitely vegetarian. Pythagoras was a lacto-vegetarian and anti-wool, anti-leather, and anti-fur. Nikola Tesla was also a lacto-vegetarian. 

If you read int...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>other</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card match">
<div class="ex-comment">I'm gonna go subscribe now and then ask the mods at /r/vegan to throw it in the sidebar.</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>other</b></span>
<span class="ex-sector">food</span></div></div>
</div></details>
<details class="ex-section" open>
<summary><span style="color:#ff9aa8;font-weight:700;">56%</span> Perceived reference stance <span style="color:#4a6a8a;font-size:0.8em;">(1.3.1b_perceived_reference_stance)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">28 matches, 22 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">Where I live, superchargers are considerably superior. Other chargers are more often than not, out of order, time restricted, more expensive, or any combination,not to mention the fact each station is owned by a different operator with each it's own ...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>neither/mixed</b></span>
<span class="ex-tag reason">Reasoning: <b>pro</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Nissan to unveil several new electric vehicles this week</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>pro</b></span>
<span class="ex-tag reason">Reasoning: <b>neither/mixed</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">&amp;gt;I was at Glastonbury helping to run a solar powered stage. I haven't noticed any change in my energy bills because I get all my electricity from 4 solar panels.

 Bet it wasn't [this stage](http://media.techworld.com/cmsdata/slideshow/3202576/sli...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>neither/mixed</b></span>
<span class="ex-tag reason">Reasoning: <b>pro</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Hello, I work for a reputable solar company in Texas, and while we are not the least expensive, we take pride in our work.  We also have a diversified offering, so we don't just help someone go solar, but we provide other options (spray foam insulati...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>neither/mixed</b></span>
<span class="ex-tag reason">Reasoning: <b>pro</b></span>
<span class="ex-sector">transport</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">I think free homes is actually a great idea seeing as we have so many homeless people and also so many homes without occupants. So yeah, your “silly little example” misfired there and I’m already questioning your beliefs.

Not to mention I looked thr...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>neither/mixed</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card match">
<div class="ex-comment">**[Saturated fat](https://en.m.wikipedia.org/wiki/Saturated_fat#/media/File:Fat_composition_in_foods.png)** 
 
 &amp;gt;A saturated fat is a type of fat in which the fatty acid chains have all single bonds. A fat known as a glyceride is made of two kinds...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>neither/mixed</b></span>
<span class="ex-sector">food</span></div></div>
</div></details>
<details class="ex-section" open>
<summary><span style="color:#ff9aa8;font-weight:700;">64%</span> Second-order normative belief <span style="color:#4a6a8a;font-size:0.8em;">(1.3.3_second_order)</span></summary>
<div class="ex-content">
<div style="margin-bottom:10px;color:#6a8caf;font-size:0.8em;">32 matches, 18 mismatches out of 50 samples</div>
<div class="ex-group-title" style="color:#ff9aa8;">Disagreements</div><div class="ex-card mismatch">
<div class="ex-comment">I totally get it. The problem is not with solar, it’s with the tilt of the earth. Solar is going to continue to be installed in a beautifully decentralized way, all over the world, and most especially in the latitudes for which it’s ideal. I’m buildi...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>1</b></span>
<span class="ex-tag reason">Reasoning: <b>0</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">I've always wondered why EV's in general don't have roofs, hoods, and trunk lids covered in thin film solar panels. Maybe the power gained isn't significant, but just like a hyper-car, every oz/gram counts.</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>1</b></span>
<span class="ex-tag reason">Reasoning: <b>0</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Oh stop whining. Be a grown up. 

If you actually believe that if we were "nicer" (e.g. acted as if we did not believe what we say to reduce your discomfort) then more people would go vegan then that reflects poorly on you. This isn't a popularity co...</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>0</b></span>
<span class="ex-tag reason">Reasoning: <b>2</b></span>
<span class="ex-sector">food</span></div></div>
<div class="ex-card mismatch">
<div class="ex-comment">Useful numbers/analysis, but it got unfair to complain about the LED or snowmelting power consumption.  We don't deduct OP's mom's vibrator power use from rooftop solar.</div>
<div class="ex-labels"><span class="ex-tag">Fast: <b>0</b></span>
<span class="ex-tag reason">Reasoning: <b>2</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-group-title" style="color:#8fcc8f;">Agreements</div><div class="ex-card match">
<div class="ex-comment">You hit the nail on the head! It’s super complicated and because it takes months for the average person to decide, it strains the solar installers. I too started with Vivint and left to work for other companies once I learned the ropes. We should con...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>0</b></span>
<span class="ex-sector">housing</span></div></div>
<div class="ex-card match">
<div class="ex-comment">I hold that rural America (and Canada, too) is going to go EV faster than most would think. I mean, what's one of the major gripes you read about on this sub all the time? "I live in an apartment so I can't charge at home."

Well, in my Minnesota tow...</div>
<div class="ex-labels"><span class="ex-tag">Both: <b>2</b></span>
<span class="ex-sector">transport</span></div></div>
</div></details>

</div>

<script>
function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(function(t){t.classList.remove('active')});
    document.querySelectorAll('.tab-btn').forEach(function(b){b.classList.remove('active')});
    document.getElementById('tab-'+id).classList.add('active');
    event.target.classList.add('active');
    // Re-trigger section animations
    document.querySelectorAll('#tab-'+id+' .sec').forEach(function(c,i){
        c.style.animation='none';c.offsetHeight;
        c.style.animation='fadeSlideUp 0.5s ease-out '+(i*0.08)+'s both';
    });
    document.querySelectorAll('#tab-'+id+' .stat-box').forEach(function(c,i){
        c.style.animation='none';c.offsetHeight;
        c.style.animation='scaleIn 0.4s ease-out '+(i*0.05)+'s both';
    });
    window.dispatchEvent(new Event('resize'));
    if(id==='norms'){setTimeout(function(){if(window._animateGauge)window._animateGauge();},100);setTimeout(function(){if(window._animateNorms)window._animateNorms();},100);setTimeout(initBubbles,200);}
    if(id==='temporal') setTimeout(function(){if(window._animateTemporal)window._animateTemporal();},200);
    if(id==='survey') setTimeout(function(){if(window._animateSurvey)window._animateSurvey();},200);
    if(id==='verification') setTimeout(function(){if(window._animateVerification)window._animateVerification();},200);
}
function toggleInfo(btn){var p=btn.parentElement.nextElementSibling;if(p&&p.classList.contains('info-popup'))p.classList.toggle('show');}
var PC={displayModeBar:false,responsive:true};
var DB='rgba(0,0,0,0)';
var DL={paper_bgcolor:DB,plot_bgcolor:DB,font:{color:'#b0c4d8',family:'Inter,sans-serif',size:10}};

// ═══════════════ GAUGE (animated from 0, replayable) ═══════════════
(function(){
    var f=40.2,t=11.6,h=16.2,avg=(f+t+h)/3,vis=f+t+h;
    Plotly.newPlot('gauge-chart',[{
        values:[0.01,0.01,0.01,0.03],labels:['Food','Transport','Housing',''],
        marker:{colors:['#5ab4ac','#af8dc3','#f4a460','rgba(0,0,0,0)'],line:{color:'#12203a',width:4}},
        hole:0.65,direction:'clockwise',sort:false,rotation:270,
        textposition:'none',type:'pie',showlegend:false,
        hovertemplate:'<b>%{label}</b><br>%{value:.1f}%<extra></extra>'
    }],Object.assign({},DL,{height:440,margin:{t:5,b:5,l:5,r:5},
        annotations:[
            {text:'<b>0.0%</b>',x:0.5,y:0.55,font:{size:46,color:'#fff'},showarrow:false},
            {text:'Avg Norm Signal',x:0.5,y:0.42,font:{size:12,color:'#6a8caf'},showarrow:false},
        ]
    }),PC);
    var _gTimer=null;
    window._animateGauge=function(){
        if(_gTimer)clearInterval(_gTimer);
        Plotly.restyle('gauge-chart',{values:[[0.01,0.01,0.01,0.03]]});
        Plotly.relayout('gauge-chart',{'annotations[0].text':'<b>0.0%</b>'});
        var steps=30,step=0;
        _gTimer=setInterval(function(){
            step++;var p=step/steps;var ease=1-Math.pow(1-p,3);
            var cf=f*ease,ct=t*ease,ch=h*ease,cv=(cf+ct+ch);
            Plotly.restyle('gauge-chart',{values:[[cf,ct,ch,cv]]});
            Plotly.relayout('gauge-chart',{'annotations[0].text':'<b>'+((cf+ct+ch)/3).toFixed(1)+'%</b>'});
            if(step>=steps)clearInterval(_gTimer);
        },30);
    };
    window._animateGauge();
})();

// ═══════════════ TREEMAP - AUTHOR STANCE ═══════════════
(function(){
    // Stance colors: green(pro) -> muted green -> neutral -> orange -> red(against)
    var sc={pro:'#8fcc8f',plo:'#7bb8a0',mix:'#b8b8a0',abp:'#e0a878',agt:'#ff9aa8'};
    // Sector parent backgrounds (dark muted)
    var sp={Food:'#1a3a4a',Transport:'#2a1a3a',Housing:'#3a2a1a'};
    // Data: author stance per sector (from dashboard, 3000/sector)
    var d={Food:{pro:735,against:252,abp:83,'neither/mixed':1404,plo:526},
           Transport:{pro:372,against:274,abp:66,'neither/mixed':1754,plo:534},
           Housing:{pro:531,against:243,abp:69,'neither/mixed':1555,plo:602}};
    var labels=['All','Food','Transport','Housing'];
    var parents=['','All','All','All'];
    var values=[0,0,0,0];
    var colors=['#0f1d33',sp.Food,sp.Transport,sp.Housing];
    var texts=['','','',''];
    var tcolors=['#fff','#fff','#fff','#fff']; // text colors per node
    var stances=[['pro','Pro',sc.pro],['plo','Pro but lack of options',sc.plo],['neither/mixed','Neither/Mixed',sc.mix],['abp','Against particular but pro',sc.abp],['against','Against',sc.agt]];
    ['Food','Transport','Housing'].forEach(function(sec){
        var total=0;for(var k in d[sec])total+=d[sec][k];
        stances.forEach(function(st){
            var v=d[sec][st[0]];
            var pct=Math.round(v/total*100);
            labels.push(sec+': '+st[1]);
            parents.push(sec);
            values.push(v);
            colors.push(st[2]);
            texts.push('<b>'+v+'</b><br>'+pct+'%');
            tcolors.push('#0a1628'); // dark text on light backgrounds
        });
    });
    Plotly.newPlot('treemap-stance-main',[{
        type:'treemap',branchvalues:'remainder',
        labels:labels,parents:parents,values:values,
        text:texts,textinfo:'label+text',
        marker:{colors:colors,line:{color:'#0a1628',width:3}},
        textfont:{color:tcolors,size:12},pathbar:{visible:false},
    }],Object.assign({},DL,{height:420,margin:{t:5,b:5,l:5,r:5}}),PC);
})();

// ═══════════════ BUBBLES ═══════════════
var bubbleData={
    categories:['family','partner/spouse','friends','coworkers','neighbors','local community','political tribe','online community','other reddit user'],
    colors:['#a8b8c2','#c49fc4','#8fbfd9','#c692c6','#7cadc6','#7cc2b8','#a8b1b8','#b8b8b8','#ffa8c2'],
    Food:[140,60,290,112,13,108,1,24,89],Transport:[36,6,26,335,24,65,5,8,97],Housing:[28,3,26,334,39,104,3,16,98]
};
function initBubbles(){
    var el=document.getElementById('bubble-pack');if(!el)return;el.innerHTML='';
    var w=el.clientWidth||900,h=320;
    var svg=d3.select('#bubble-pack').append('svg').attr('viewBox','0 0 '+w+' '+h);
    var sectors=['Food','Transport','Housing'],cw=w/3,nodes=[];
    sectors.forEach(function(sec,si){
        var cx=cw*si+cw/2;
        svg.append('text').attr('x',cx).attr('y',18).attr('class','bubble-sector-label').attr('text-anchor','middle').text(sec.toUpperCase());
        bubbleData.categories.forEach(function(cat,ci){
            var val=bubbleData[sec][ci];if(val===0)return;
            nodes.push({category:cat,value:val,r:Math.sqrt(val)*2.2,color:bubbleData.colors[ci],cx:cx,cy:h/2+5,x:cx+(Math.random()-0.5)*60,y:h/2+5+(Math.random()-0.5)*60});
        });
    });
    svg.selectAll('.sep').data([1,2]).enter().append('line')
        .attr('x1',function(d){return cw*d}).attr('x2',function(d){return cw*d})
        .attr('y1',28).attr('y2',h-5).attr('stroke','#1a3050').attr('stroke-width',1).attr('stroke-dasharray','4,4');
    var g=svg.selectAll('.b').data(nodes).enter().append('g');
    g.append('circle').attr('cx',function(d){return d.x}).attr('cy',function(d){return d.y}).attr('r',0)
        .attr('fill',function(d){return d.color}).attr('fill-opacity',0.85).attr('stroke',function(d){return d.color}).attr('stroke-opacity',0.3).attr('stroke-width',2)
        .transition().duration(800).delay(function(d,i){return i*30}).attr('r',function(d){return d.r});
    g.append('text').attr('x',function(d){return d.x}).attr('y',function(d){return d.y-2}).attr('class','bubble-label')
        .attr('font-size',function(d){return Math.max(8,Math.min(d.r*0.6,13))+'px'}).attr('opacity',0)
        .text(function(d){return d.value>=8?d.category:''}).transition().duration(600).delay(function(d,i){return 800+i*30}).attr('opacity',1);
    g.append('text').attr('x',function(d){return d.x}).attr('y',function(d){return d.y+(d.r>20?12:8)}).attr('class','bubble-label')
        .attr('font-size',function(d){return Math.max(9,Math.min(d.r*0.55,14))+'px'}).attr('font-weight','700').attr('opacity',0)
        .text(function(d){return d.value}).transition().duration(600).delay(function(d,i){return 800+i*30}).attr('opacity',1);
    d3.forceSimulation(nodes).force('x',d3.forceX(function(d){return d.cx}).strength(0.1))
        .force('y',d3.forceY(h/2+10).strength(0.08)).force('collide',d3.forceCollide(function(d){return d.r+2}).strength(0.95))
        .force('charge',d3.forceManyBody().strength(-1)).alpha(0.8)
        .on('tick',function(){
            g.select('circle').attr('cx',function(d){return d.x}).attr('cy',function(d){return d.y});
            g.selectAll('text').attr('x',function(d){return d.x});
            g.select('text:nth-child(2)').attr('y',function(d){return d.y-2});
            g.select('text:nth-child(3)').attr('y',function(d){return d.y+(d.r>20?12:8)});
        });
    var le=document.getElementById('bubble-legend');le.innerHTML='';
    bubbleData.categories.forEach(function(c,i){le.innerHTML+='<span class="legend-item"><span class="legend-dot" style="background:'+bubbleData.colors[i]+'"></span>'+c+'</span>';});
}

// ═══════════════ NORMS SANKEY (sectors → dimensions → categories, per-sector links) ═══════════════
(function(){
    // Per-sector data: [present/strong/pro, absent/weak/against, unclear/none/mixed]
    var SD={
        Food:     {desc:[874,743,1383],  inj:[288,2526,186],  sec:[377,628,1995], perc:[467,152,2381]},
        Transport:{desc:[419,2176,405],  inj:[150,2805,45],   sec:[319,480,2201], perc:[888,350,1762]},
        Housing:  {desc:[395,1957,648],  inj:[206,2735,59],   sec:[362,522,2116], perc:[803,368,1829]}
    };
    var secs=['Food','Transport','Housing'],dims=['desc','inj','sec','perc'];
    // 19 nodes: 0-2 sectors, 3-6 dimensions, 7-18 categories
    var baseLabels=['Food<br>3,000','Transport<br>3,000','Housing<br>3,000',
        'Descriptive<br>Norm','Injunctive<br>Norm','Second-Order<br>Belief','Perceived<br>Stance'];
    var catNames=[['Present','Absent','Unclear'],['Present','Absent','Unclear'],
        ['Strong','Weak','None'],['Pro','Against','Mixed']];
    // Aggregate category totals
    var catTotals=[];
    dims.forEach(function(d,di){
        [0,1,2].forEach(function(ci){
            var t=0;secs.forEach(function(s){t+=SD[s][d][ci]});
            catTotals.push({name:catNames[di][ci],total:t});
        });
    });
    var catLabelsAll=catTotals.map(function(c){return c.name+'<br>'+c.total.toLocaleString()});
    // Per-sector category labels
    var catLabelsSec={};
    secs.forEach(function(s){
        catLabelsSec[s]=[];
        dims.forEach(function(d,di){
            [0,1,2].forEach(function(ci){
                catLabelsSec[s].push(catNames[di][ci]+'<br>'+SD[s][d][ci].toLocaleString());
            });
        });
    });
    var nl=baseLabels.concat(catLabelsAll);
    var nc=['#5ab4ac','#af8dc3','#f4a460',
        '#7caed6','#8fbfd9','#b8a8c8','#8fcc8f',
        '#7caed6','#566a7a','#8a9aa8',
        '#8fbfd9','#566a7a','#8a9aa8',
        '#ffb0a0','#8fbfd9','#8a9aa8',
        '#8fcc8f','#ff9aa8','#ffe87a'];
    // Build links: 48 total, organized by sector (0-15 Food, 16-31 Transport, 32-47 Housing)
    var src=[],tgt=[],val=[];
    secs.forEach(function(s,si){
        // 4 sector→dimension links
        dims.forEach(function(d,di){src.push(si);tgt.push(3+di);val.push(3000);});
        // 12 dimension→category links (per sector)
        dims.forEach(function(d,di){
            SD[s][d].forEach(function(v,ci){src.push(3+di);tgt.push(7+di*3+ci);val.push(v);});
        });
    });
    // Color helpers
    var SC={Food:'90,180,172',Transport:'175,141,195',Housing:'244,164,96'};
    function getLinkColors(active){
        var c=[];
        secs.forEach(function(s){
            var bright='rgba('+SC[s]+',0.45)',dim='rgba('+SC[s]+',0.06)';
            var use=(active==='all'||active===s)?bright:dim;
            for(var i=0;i<16;i++)c.push(use);
        });
        return c;
    }
    // Default: Food highlighted
    Plotly.newPlot('sankey-norms',[{type:'sankey',orientation:'h',
        node:{label:nl,color:nc,pad:20,thickness:30,line:{color:'#0a1628',width:1}},
        link:{source:src,target:tgt,value:val,color:getLinkColors('Food')}
    }],Object.assign({},DL,{height:480,margin:{t:10,b:10,l:10,r:10}}),PC);
    // Toggle sector
    window._sankeySetSector=function(sec){
        var newColors=getLinkColors(sec);
        var newLabels;
        if(sec==='all'){
            newLabels=baseLabels.concat(catLabelsAll);
        }else{
            // Update dimension labels to show per-sector total
            var dimLabels=['Descriptive<br>Norm','Injunctive<br>Norm','Second-Order<br>Belief','Perceived<br>Stance'];
            var secLabel=[sec+'<br>3,000'];
            var otherSecs=secs.filter(function(s){return s!==sec});
            var sLabels=secs.map(function(s){return s=== sec?(s+'<br>3,000'):(s+'<br><span style="opacity:0.3">3,000</span>');});
            newLabels=sLabels.concat(dimLabels).concat(catLabelsSec[sec]);
        }
        Plotly.restyle('sankey-norms',{'link.color':[newColors],'node.label':[newLabels]},0);
        document.querySelectorAll('.sankey-toggle').forEach(function(b){
            b.classList.toggle('active',b.dataset.sec===sec);
        });
    };
})();
window._animateNorms=function(){
    // Re-trigger default sector selection
    if(window._sankeySetSector) window._sankeySetSector('Food');
};

// ═══════════════ SURVEY RADIALS (D3 sequential spoke animation) ═══════════════
// D3.arc: 0 = 12 o'clock, angles go clockwise
// To place labels with Math.cos/sin, convert: trigAngle = d3Angle - PI/2
function drawRadial(svgId, labels, values, baseColor, maxR, delay){
    var svg=d3.select('#'+svgId);
    var cx=230,cy=210,outerR=130;
    var n=labels.length, sliceAngle=2*Math.PI/n;
    var gapFrac=0.15; // fraction of slice that is gap
    var spokeAngle=sliceAngle*(1-gapFrac);
    var bc=baseColor;
    var arc=d3.arc();
    // Grid circles
    [0.25,0.5,0.75,1.0].forEach(function(s){
        svg.append('circle').attr('cx',cx).attr('cy',cy).attr('r',outerR*s)
            .attr('fill','none').attr('stroke','#1a2a40').attr('stroke-width',0.5);
    });
    // Grid tick labels (at top)
    [0.25,0.5,0.75,1.0].forEach(function(s){
        svg.append('text').attr('x',cx+3).attr('y',cy-outerR*s-1)
            .attr('fill','#3a5a7a').attr('font-size','8px').attr('font-family','Inter,sans-serif')
            .text((maxR*s).toFixed(0)+'%');
    });
    // Build spoke data - all angles in D3 convention (0=top, clockwise)
    var spokes=[];
    values.forEach(function(v,i){
        // D3 arc angles: each spoke centered at i*sliceAngle
        var centerD3=i*sliceAngle;
        var startD3=centerD3-spokeAngle/2;
        var endD3=centerD3+spokeAngle/2;
        var r=Math.max(3, outerR*(v/maxR));
        var alpha=0.3+0.65*(v/maxR); if(alpha>0.95)alpha=0.95;
        // Convert center to trig angle for label placement
        var trigMid=centerD3-Math.PI/2;
        var g=svg.append('g').style('cursor','pointer');
        var path=g.append('path')
            .attr('d',arc({innerRadius:0,outerRadius:r,startAngle:startD3,endAngle:endD3}))
            .attr('transform','translate('+cx+','+cy+')')
            .attr('fill',bc).attr('fill-opacity',alpha)
            .attr('stroke',bc).attr('stroke-opacity',0.6).attr('stroke-width',1)
            .attr('opacity',0);
        // Tooltip on hover
        g.append('title').text(labels[i]+': '+v.toFixed(1)+'%');
        // Hover highlight
        g.on('mouseover',function(){d3.select(this).select('path').attr('stroke','#fff').attr('stroke-width',2).attr('stroke-opacity',1);})
         .on('mouseout',function(){d3.select(this).select('path').attr('stroke',bc).attr('stroke-width',1).attr('stroke-opacity',0.6);});
        spokes.push({g:g,path:path,label:labels[i],value:v,startD3:startD3,endD3:endD3,r:r,trigMid:trigMid,alpha:alpha});
    });
    // Labels at spoke centers
    spokes.forEach(function(s,i){
        var lx=cx+Math.cos(s.trigMid)*(outerR+16);
        var ly=cy+Math.sin(s.trigMid)*(outerR+16);
        var anchor=Math.abs(Math.cos(s.trigMid))<0.15?'middle':(Math.cos(s.trigMid)>0?'start':'end');
        svg.append('text').attr('x',lx).attr('y',ly+4)
            .attr('text-anchor',anchor).attr('fill','#6a8caf')
            .attr('font-size','9px').attr('font-family','Inter,sans-serif')
            .attr('opacity',0).attr('class','rl-'+svgId+'-'+i)
            .text(s.label);
    });
    // Sequential animation
    window['_animRadial_'+svgId]=function(){
        spokes.forEach(function(s,i){
            s.path.transition()
                .delay(delay+i*120).duration(500).ease(d3.easeCubicOut)
                .attr('opacity',1)
                .attrTween('d',function(){
                    return function(t){
                        return arc({innerRadius:0,outerRadius:s.r*t,startAngle:s.startD3,endAngle:s.endD3});
                    };
                });
            // Value label - pushed toward outer edge of spoke, skip tiny ones
            var labelR=Math.max(s.r*0.72, 18);
            var vx=cx+Math.cos(s.trigMid)*labelR;
            var vy=cy+Math.sin(s.trigMid)*labelR+3;
            var showLabel=s.value>=2.5 && s.r>15;
            svg.append('text').attr('x',vx).attr('y',vy)
                .attr('text-anchor','middle').attr('fill','#fff').attr('font-weight','600')
                .attr('font-size',s.r>50?'11px':s.r>30?'9px':'7px').attr('font-family','Inter,sans-serif')
                .attr('pointer-events','none')
                .attr('opacity',0).text(showLabel?s.value.toFixed(1)+'%':'')
                .transition().delay(delay+i*120+300).duration(300).attr('opacity',showLabel?0.9:0);
            // Outer label fade in
            d3.select('.rl-'+svgId+'-'+i)
                .transition().delay(delay+i*120+200).duration(300).attr('opacity',1);
        });
    };
}
drawRadial('radial-food',
    ['health','convenience','cost','social prompting','barriers','identity','animal welfare','climate','alt. meat','reduce red meat','dairy alt.','lab-grown','taste'],
    [5.2,9.6,2.8,12.2,5.2,4.4,20.0,6.0,6.2,3.8,4.0,0.0,9.6],'#5ab4ac',25,0);
drawRadial('radial-transport',
    ['environment','purchase cost','operating cost','infrastructure','driving exp.','reliability'],
    [3.0,7.8,4.8,4.4,6.8,7.4],'#af8dc3',10,0);
drawRadial('radial-housing',
    ['cost savings','confidence','env. benefit','obsolescence','payback','climate','installer trust','support info','maintenance','performance'],
    [11.6,8.8,14.0,4.6,7.0,1.8,5.0,1.0,0.6,6.6],'#f4a460',15,0);
window._animateSurvey=function(){
    // Reset and replay - clear dynamic elements, redraw
    ['radial-food','radial-transport','radial-housing'].forEach(function(id){
        var svg=document.getElementById(id);
        svg.innerHTML='';
    });
    drawRadial('radial-food',
        ['health','convenience','cost','social prompting','barriers','identity','animal welfare','climate','alt. meat','reduce red meat','dairy alt.','lab-grown','taste'],
        [5.2,9.6,2.8,12.2,5.2,4.4,20.0,6.0,6.2,3.8,4.0,0.0,9.6],'#5ab4ac',25,0);
    drawRadial('radial-transport',
        ['environment','purchase cost','operating cost','infrastructure','driving exp.','reliability'],
        [3.0,7.8,4.8,4.4,6.8,7.4],'#af8dc3',10,0);
    drawRadial('radial-housing',
        ['cost savings','confidence','env. benefit','obsolescence','payback','climate','installer trust','support info','maintenance','performance'],
        [11.6,8.8,14.0,4.6,7.0,1.8,5.0,1.0,0.6,6.6],'#f4a460',15,0);
    window['_animRadial_radial-food']();
    window['_animRadial_radial-transport']();
    window['_animRadial_radial-housing']();
};

// ═══════════════ VERIFICATION CHARTS (animated) ═══════════════
// Accuracy by question - start at 0
Plotly.newPlot('chart-acc',[{
    y:["1.3.1b_perceived_reference_stance", "1.1.1_stance", "1.2.1_descriptive", "1.3.3_second_order", "diet_13", "diet_6", "diet_2", "1.2.2_injunctive", "ev_2", "1.3.1_reference_group", "1.1_gate", "diet_4", "diet_5", "diet_14", "solar_2", "solar_1", "ev_1", "solar_10", "diet_10", "ev_5", "diet_1", "diet_9", "diet_17", "ev_3", "ev_6", "solar_5", "solar_7", "solar_9", "ev_4", "solar_3", "solar_4", "solar_6", "diet_3", "diet_8", "diet_11", "solar_8"], x:[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0].map(function(){return 0}), type:'bar', orientation:'h',
    marker:{color:["#ff9aa8", "#ff9aa8", "#ff9aa8", "#ff9aa8", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f"],line:{width:0}},
    text:[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0].map(function(){return ''}),
    textposition:'outside',textfont:{size:8,color:'#b0c4d8'},
    hovertemplate:'%{y}<br>Accuracy: %{x:.1%}<extra></extra>'
}],Object.assign({},DL,{
    height:500,margin:{l:200,t:5,b:30,r:40},
    xaxis:{range:[0,1.08],tickformat:'.0%',gridcolor:'#1a2a40',tickfont:{size:8,color:'#4a6a8a'}},
    yaxis:{tickfont:{size:8,color:'#b0c4d8'}},showlegend:false
}),PC);

// Estimation errors - start at 0
Plotly.newPlot('chart-est',[{
    y:["diet_6 - no", "diet_6 - yes", "1.1.1_stance - neither/mi", "1.2.1_descriptive - unclear", "1.3.1b_perceived_referenc - neither/mi", "1.1.1_stance - pro", "1.2.2_injunctive - present", "1.2.2_injunctive - absent", "1.3.1b_perceived_referenc - against", "1.3.3_second_order - 1", "diet_5 - no", "diet_5 - yes", "diet_13 - no", "diet_13 - yes", "1.3.1_reference_group - other", "ev_2 - no", "ev_2 - yes", "solar_2 - no", "solar_2 - yes", "1.1.1_stance - pro but la", "1.2.1_descriptive - absent", "1.2.1_descriptive - explicitly", "1.1.1_stance - against", "1.3.3_second_order - 0", "diet_4 - no", "diet_4 - yes", "1.3.3_second_order - 2", "ev_5 - no", "ev_5 - yes", "1.1_gate - 0", "1.1_gate - 1", "1.1.1_stance - against pa", "1.3.1_reference_group - coworkers", "1.3.1_reference_group - other redd", "1.3.1b_perceived_referenc - pro", "diet_14 - no", "diet_14 - yes", "ev_1 - no", "ev_1 - yes", "solar_7 - no"], x:[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0].map(function(){return 0}), type:'bar', orientation:'h',
    marker:{color:["#ff9aa8", "#5ab4ac", "#ff9aa8", "#ff9aa8", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#ff9aa8", "#ff9aa8", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#ff9aa8", "#ff9aa8", "#5ab4ac", "#ff9aa8", "#5ab4ac", "#5ab4ac", "#ff9aa8", "#ff9aa8"],line:{width:0}},
    text:[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0].map(function(){return ''}),
    textposition:'outside',textfont:{size:7,color:'#b0c4d8'},showlegend:false,
    hovertemplate:'%{y}<br>Error: %{x:+.1f}pp<extra></extra>'
}],Object.assign({},DL,{
    height:500,margin:{l:180,t:20,b:30,r:40},
    xaxis:{gridcolor:'#1a2a40',zeroline:true,zerolinecolor:'#4a6a8a',zerolinewidth:1.5,tickfont:{size:8,color:'#4a6a8a'}},
    yaxis:{tickfont:{size:7,color:'#b0c4d8'}},showlegend:false,
    annotations:[
        {x:-25,y:1.02,xref:'x',yref:'paper',text:'\u2190 Underestimation',showarrow:false,font:{size:9,color:'#5ab4ac'}},
        {x:25,y:1.02,xref:'x',yref:'paper',text:'Overestimation \u2192',showarrow:false,font:{size:9,color:'#c06070'}}
    ]
}),PC);
// Confidence vs Mismatch - box plot
Plotly.newPlot('chart-conf-box',[{
    x:["50-60%", "60-70%", "70-80%", "80-90%", "90-100%"], y:[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201].map(function(){return 0}), type:'bar',
    marker:{color:['#8fcc8f','#ffb87a','#ff9aa8','#ffb87a','#8fcc8f'],line:{width:0}},
    text:[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201].map(function(){return ''}),textposition:'outside',textfont:{size:9,color:'#b0c4d8'},
    hovertemplate:'Confidence: %{x}<br>Mismatch: %{y:.1f}%<extra></extra>'
}],Object.assign({},DL,{
    height:220,margin:{l:50,t:5,b:35,r:15},
    xaxis:{title:{text:'Confidence',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#6a8caf'}},
    yaxis:{title:{text:'Mismatch (%)',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40',range:[0,50]},
    showlegend:false
}),PC);

// Confidence vs Mismatch - scatter
Plotly.newPlot('chart-conf-scatter',[{
    x:[0.8051419679823981, 0.8296872452548417, 0.8362761023023664, 0.8529739250870995, 0.8739335202894933, 0.9137630463826928, 0.9167092652395396, 0.921294718270656, 0.9278022013681547, 0.9304223275104322, 0.9332773924905254, 0.9392596368185305, 0.9446321788213673, 0.9471621796430767, 0.9497528580148543, 0.9565779408039021, 0.9572864192299501, 0.9593251068738364, 0.9607312250263359, 0.9642499949623131, 0.9643862862742266, 0.9656835172202384, 0.9684804451265628, 0.9701197369368744, 0.970225483343859, 0.9708862650857033, 0.9772050452453918, 0.9783345785937613, 0.9812347414029703, 0.9823331350417349, 0.9823604278438541, 0.9833207568885516, 0.9843866350763824, 0.9855410801400545, 0.9862287961472944, 0.9935957973416383].map(function(){return 0.5}), y:[20.0, 44.0, 42.0, 40.0, 22.0, 36.0, 10.0, 12.0, 14.000000000000002, 4.0, 14.000000000000002, 10.0, 6.0, 6.0, 18.0, 24.0, 26.0, 6.0, 8.0, 4.0, 6.0, 28.000000000000004, 22.0, 2.0, 6.0, 18.0, 0.0, 6.0, 18.0, 8.0, 0.0, 6.0, 4.0, 4.0, 6.0, 0.0].map(function(){return 0}),
    text:["1.3.1_reference_group", "1.3.1b_perceived_reference_sta", "1.1.1_stance", "1.2.1_descriptive", "1.2.2_injunctive", "1.3.3_second_order", "solar_10", "solar_1", "solar_2", "solar_3", "diet_14", "ev_1", "diet_1", "ev_6", "diet_4", "diet_2", "diet_6", "solar_5", "diet_10", "solar_4", "solar_9", "diet_13", "ev_2", "diet_3", "ev_3", "diet_5", "diet_11", "solar_7", "1.1_gate", "ev_5", "solar_8", "diet_9", "ev_4", "solar_6", "diet_17", "diet_8"], mode:'markers',type:'scatter',
    marker:{color:'#5ab4ac',size:8,opacity:0.7,line:{color:'#0a1628',width:1}},
    hovertemplate:'<b>%{text}</b><br>Avg Conf: %{x:.3f}<br>Mismatch: %{y:.1f}%<extra></extra>'
}],Object.assign({},DL,{
    height:220,margin:{l:50,t:5,b:35,r:15},
    xaxis:{title:{text:'Avg Confidence',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40',range:[0.5,1]},
    yaxis:{title:{text:'Mismatch (%)',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40'},
    showlegend:false
}),PC);

// High-conf accuracy bar chart
Plotly.newPlot('chart-hc-acc',[{
    y:["1.3.1_reference_group", "1.3.3_second_order", "diet_13", "diet_6", "ev_2", "1.3.1b_perceived_reference_stance", "diet_2", "diet_5", "diet_4", "1.2.2_injunctive", "1.1_gate", "ev_1", "diet_10", "solar_10", "solar_7", "solar_9", "solar_2", "diet_9", "diet_14", "ev_3", "ev_4", "ev_5", "diet_17", "solar_1", "ev_6", "solar_5", "solar_4", "1.1.1_stance", "1.2.1_descriptive", "diet_1", "diet_3", "diet_8", "diet_11", "solar_3", "solar_6", "solar_8"], x:[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0].map(function(){return 0}), type:'bar', orientation:'h',
    marker:{color:["#ff9aa8", "#ff9aa8", "#ff9aa8", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#ffb87a", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f", "#8fcc8f"],line:{width:0}},
    text:[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0].map(function(){return ''}),
    textposition:'outside',textfont:{size:7,color:'#b0c4d8'},
    hovertemplate:'%{y}<br>Accuracy (Conf>0.9): %{x:.1%}<extra></extra>'
}],Object.assign({},DL,{
    height:500,margin:{l:200,t:5,b:30,r:40},
    xaxis:{range:[0,1.08],tickformat:'.0%',gridcolor:'#1a2a40',tickfont:{size:8,color:'#4a6a8a'}},
    yaxis:{tickfont:{size:7,color:'#b0c4d8'}},showlegend:false
}),PC);

// Animate verification charts when tab shown - replays every time
window._animateVerification=function(){
    // Reset to 0 first
    Plotly.restyle('chart-acc',{x:[[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0].map(function(){return 0})],text:[[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0].map(function(){return ''})]},0);
    Plotly.restyle('chart-est',{x:[[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0].map(function(){return 0})],text:[[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0].map(function(){return ''})]},0);
    Plotly.restyle('chart-conf-box',{y:[[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201].map(function(){return 0})],text:[[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201].map(function(){return ''})]},0);
    Plotly.restyle('chart-conf-scatter',{x:[[0.8051419679823981, 0.8296872452548417, 0.8362761023023664, 0.8529739250870995, 0.8739335202894933, 0.9137630463826928, 0.9167092652395396, 0.921294718270656, 0.9278022013681547, 0.9304223275104322, 0.9332773924905254, 0.9392596368185305, 0.9446321788213673, 0.9471621796430767, 0.9497528580148543, 0.9565779408039021, 0.9572864192299501, 0.9593251068738364, 0.9607312250263359, 0.9642499949623131, 0.9643862862742266, 0.9656835172202384, 0.9684804451265628, 0.9701197369368744, 0.970225483343859, 0.9708862650857033, 0.9772050452453918, 0.9783345785937613, 0.9812347414029703, 0.9823331350417349, 0.9823604278438541, 0.9833207568885516, 0.9843866350763824, 0.9855410801400545, 0.9862287961472944, 0.9935957973416383].map(function(){return 0.5})],y:[[20.0, 44.0, 42.0, 40.0, 22.0, 36.0, 10.0, 12.0, 14.000000000000002, 4.0, 14.000000000000002, 10.0, 6.0, 6.0, 18.0, 24.0, 26.0, 6.0, 8.0, 4.0, 6.0, 28.000000000000004, 22.0, 2.0, 6.0, 18.0, 0.0, 6.0, 18.0, 8.0, 0.0, 6.0, 4.0, 4.0, 6.0, 0.0].map(function(){return 0})]},0);
    Plotly.restyle('chart-hc-acc',{x:[[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0].map(function(){return 0})],text:[[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0].map(function(){return ''})]},0);
    setTimeout(function(){
        Plotly.animate('chart-acc',{data:[{x:[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0],text:[0.56, 0.58, 0.6, 0.64, 0.72, 0.74, 0.76, 0.78, 0.78, 0.8, 0.82, 0.82, 0.82, 0.86, 0.86, 0.88, 0.9, 0.9, 0.92, 0.92, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.94, 0.96, 0.96, 0.96, 0.96, 0.98, 1.0, 1.0, 1.0].map(function(v){return (v*100).toFixed(0)+'%'})}]},{
            transition:{duration:900,easing:'cubic-out'},frame:{duration:900}});
        Plotly.animate('chart-est',{data:[{x:[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0],text:[26.0, -26.0, 24.0, 24.0, 24.0, -20.0, -20.0, 18.0, -18.0, 18.0, 18.0, -18.0, 16.0, -16.0, -14.0, 14.0, -14.0, -14.0, 14.0, 12.0, -12.0, -12.0, -10.0, -10.0, 10.0, -10.0, -8.0, -8.0, 8.0, -6.0, 6.0, -6.0, 6.0, 6.0, -6.0, 6.0, -6.0, -6.0, 6.0, 6.0].map(function(v){return (v>0?'+':'')+v+'pp'})}]},{
            transition:{duration:900,easing:'cubic-out'},frame:{duration:900}});
        Plotly.animate('chart-conf-box',{data:[{y:[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201],text:[0, 36.36363636363637, 39.097744360902254, 28.115015974440894, 7.892777364110201].map(function(v){return v.toFixed(1)+'%'})}]},{
            transition:{duration:800,easing:'cubic-out'},frame:{duration:800}});
        Plotly.animate('chart-conf-scatter',{data:[{x:[0.8051419679823981, 0.8296872452548417, 0.8362761023023664, 0.8529739250870995, 0.8739335202894933, 0.9137630463826928, 0.9167092652395396, 0.921294718270656, 0.9278022013681547, 0.9304223275104322, 0.9332773924905254, 0.9392596368185305, 0.9446321788213673, 0.9471621796430767, 0.9497528580148543, 0.9565779408039021, 0.9572864192299501, 0.9593251068738364, 0.9607312250263359, 0.9642499949623131, 0.9643862862742266, 0.9656835172202384, 0.9684804451265628, 0.9701197369368744, 0.970225483343859, 0.9708862650857033, 0.9772050452453918, 0.9783345785937613, 0.9812347414029703, 0.9823331350417349, 0.9823604278438541, 0.9833207568885516, 0.9843866350763824, 0.9855410801400545, 0.9862287961472944, 0.9935957973416383],y:[20.0, 44.0, 42.0, 40.0, 22.0, 36.0, 10.0, 12.0, 14.000000000000002, 4.0, 14.000000000000002, 10.0, 6.0, 6.0, 18.0, 24.0, 26.0, 6.0, 8.0, 4.0, 6.0, 28.000000000000004, 22.0, 2.0, 6.0, 18.0, 0.0, 6.0, 18.0, 8.0, 0.0, 6.0, 4.0, 4.0, 6.0, 0.0]}]},{
            transition:{duration:1000,easing:'cubic-out'},frame:{duration:1000}});
        Plotly.animate('chart-hc-acc',{data:[{x:[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],text:[0.5714285714285714, 0.625, 0.6976744186046512, 0.7906976744186046, 0.7906976744186046, 0.8, 0.8205128205128205, 0.8478260869565217, 0.8648648648648649, 0.9047619047619048, 0.9111111111111111, 0.9142857142857143, 0.9285714285714286, 0.9310344827586207, 0.9347826086956522, 0.9347826086956522, 0.9354838709677419, 0.9375, 0.9444444444444444, 0.9555555555555556, 0.9565217391304348, 0.9565217391304348, 0.9583333333333334, 0.967741935483871, 0.9705882352941176, 0.975609756097561, 0.9767441860465116, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0].map(function(v){return (v*100).toFixed(0)+'%'})}]},{
            transition:{duration:900,easing:'cubic-out'},frame:{duration:900}});
    },50);
};

// ═══════════════ TEMPORAL CHARTS ═══════════════
(function(){
    var YEARS=[2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];
    var tStance={"food": {"pro": {"2010": 16.5, "2011": 27.0, "2012": 26.5, "2013": 30.5, "2014": 23.0, "2015": 27.0, "2016": 28.5, "2017": 25.5, "2018": 25.5, "2019": 25.0, "2020": 26.5, "2021": 24.5, "2022": 20.0, "2023": 18.5, "2024": 23.0}, "against": {"2010": 8.0, "2011": 5.5, "2012": 6.0, "2013": 6.0, "2014": 6.5, "2015": 7.5, "2016": 9.0, "2017": 6.5, "2018": 9.5, "2019": 9.5, "2020": 11.0, "2021": 8.0, "2022": 9.5, "2023": 12.0, "2024": 11.5}, "against particular but pro": {"2010": 3.0, "2011": 4.0, "2012": 0.5, "2013": 2.5, "2014": 2.5, "2015": 2.5, "2016": 2.0, "2017": 2.5, "2018": 5.0, "2019": 0.5, "2020": 2.5, "2021": 5.0, "2022": 3.0, "2023": 3.0, "2024": 3.0}, "neither/mixed": {"2010": 52.0, "2011": 49.5, "2012": 48.0, "2013": 42.5, "2014": 48.0, "2015": 48.5, "2016": 45.0, "2017": 53.0, "2018": 46.0, "2019": 49.0, "2020": 44.5, "2021": 40.5, "2022": 48.0, "2023": 46.0, "2024": 41.5}, "pro but lack of options": {"2010": 20.5, "2011": 14.0, "2012": 19.0, "2013": 18.5, "2014": 20.0, "2015": 14.5, "2016": 15.5, "2017": 12.5, "2018": 14.0, "2019": 16.0, "2020": 15.5, "2021": 22.0, "2022": 19.5, "2023": 20.5, "2024": 21.0}}, "transport": {"pro": {"2010": 19.3, "2011": 18.3, "2012": 16.0, "2013": 10.0, "2014": 17.4, "2015": 14.5, "2016": 16.3, "2017": 12.7, "2018": 13.0, "2019": 9.6, "2020": 11.6, "2021": 7.2, "2022": 11.8, "2023": 8.4, "2024": 11.3}, "against": {"2010": 15.8, "2011": 11.3, "2012": 8.0, "2013": 11.0, "2014": 10.0, "2015": 5.5, "2016": 11.9, "2017": 12.2, "2018": 6.7, "2019": 6.0, "2020": 5.4, "2021": 5.9, "2022": 8.4, "2023": 12.9, "2024": 12.0}, "against particular but pro": {"2010": 0.0, "2011": 1.4, "2012": 0.5, "2013": 1.5, "2014": 1.5, "2015": 3.0, "2016": 3.5, "2017": 1.5, "2018": 1.0, "2019": 0.5, "2020": 1.8, "2021": 5.1, "2022": 3.8, "2023": 2.8, "2024": 2.3}, "neither/mixed": {"2010": 47.4, "2011": 59.2, "2012": 62.5, "2013": 55.5, "2014": 54.7, "2015": 59.0, "2016": 55.9, "2017": 55.6, "2018": 63.5, "2019": 62.8, "2020": 62.9, "2021": 62.0, "2022": 53.4, "2023": 61.4, "2024": 54.1}, "pro but lack of options": {"2010": 17.5, "2011": 9.9, "2012": 13.0, "2013": 22.0, "2014": 16.4, "2015": 18.0, "2016": 12.4, "2017": 18.0, "2018": 15.9, "2019": 21.1, "2020": 18.3, "2021": 19.8, "2022": 22.5, "2023": 14.5, "2024": 20.3}}, "housing": {"pro": {"2010": 27.9, "2011": 29.4, "2012": 22.0, "2013": 24.1, "2014": 23.9, "2015": 15.3, "2016": 18.1, "2017": 22.8, "2018": 16.4, "2019": 17.0, "2020": 13.8, "2021": 11.5, "2022": 12.1, "2023": 9.9, "2024": 15.5}, "against": {"2010": 14.0, "2011": 6.9, "2012": 6.0, "2013": 12.3, "2014": 10.0, "2015": 7.4, "2016": 4.8, "2017": 6.8, "2018": 4.8, "2019": 6.3, "2020": 5.2, "2021": 7.4, "2022": 8.4, "2023": 14.4, "2024": 9.9}, "against particular but pro": {"2010": 0.0, "2011": 0.6, "2012": 0.0, "2013": 3.0, "2014": 1.5, "2015": 2.0, "2016": 3.3, "2017": 3.4, "2018": 1.4, "2019": 2.4, "2020": 4.3, "2021": 2.3, "2022": 2.1, "2023": 4.1, "2024": 1.6}, "neither/mixed": {"2010": 39.5, "2011": 50.6, "2012": 59.0, "2013": 41.9, "2014": 48.8, "2015": 52.2, "2016": 55.7, "2017": 51.0, "2018": 54.1, "2019": 54.9, "2020": 53.8, "2021": 51.6, "2022": 54.8, "2023": 48.6, "2024": 51.2}, "pro but lack of options": {"2010": 18.6, "2011": 12.5, "2012": 13.0, "2013": 18.7, "2014": 15.9, "2015": 23.2, "2016": 18.1, "2017": 16.0, "2018": 23.2, "2019": 19.4, "2020": 22.9, "2021": 27.2, "2022": 22.6, "2023": 23.0, "2024": 21.8}}};
    var tNorms={"food": {"1.2.1_descriptive": {"explicitly present": {"2010": 26.0, "2011": 31.5, "2012": 37.0, "2013": 34.0, "2014": 29.0, "2015": 30.0, "2016": 35.5, "2017": 32.0, "2018": 27.0, "2019": 25.0, "2020": 25.5, "2021": 24.5, "2022": 22.0, "2023": 24.0, "2024": 34.0}, "absent": {"2010": 22.5, "2011": 25.5, "2012": 16.5, "2013": 17.5, "2014": 22.0, "2015": 23.5, "2016": 26.0, "2017": 22.0, "2018": 26.5, "2019": 24.5, "2020": 32.5, "2021": 30.0, "2022": 30.0, "2023": 29.0, "2024": 23.5}, "unclear": {"2010": 51.5, "2011": 43.0, "2012": 46.5, "2013": 48.5, "2014": 49.0, "2015": 46.5, "2016": 38.5, "2017": 46.0, "2018": 46.5, "2019": 50.5, "2020": 42.0, "2021": 45.5, "2022": 48.0, "2023": 47.0, "2024": 42.5}}, "1.2.2_injunctive": {"present": {"2010": 5.5, "2011": 11.0, "2012": 11.0, "2013": 11.5, "2014": 9.5, "2015": 11.0, "2016": 11.5, "2017": 8.5, "2018": 7.0, "2019": 7.5, "2020": 9.0, "2021": 13.0, "2022": 11.0, "2023": 7.0, "2024": 10.0}, "absent": {"2010": 87.0, "2011": 85.0, "2012": 85.5, "2013": 84.0, "2014": 82.0, "2015": 82.0, "2016": 82.5, "2017": 87.0, "2018": 84.0, "2019": 87.0, "2020": 85.0, "2021": 77.5, "2022": 83.5, "2023": 87.0, "2024": 84.0}, "unclear": {"2010": 7.5, "2011": 4.0, "2012": 3.5, "2013": 4.5, "2014": 8.5, "2015": 7.0, "2016": 6.0, "2017": 4.5, "2018": 9.0, "2019": 5.5, "2020": 6.0, "2021": 9.5, "2022": 5.5, "2023": 6.0, "2024": 6.0}}, "1.3.3_second_order": {"2": {"2010": 10.5, "2011": 10.0, "2012": 13.0, "2013": 15.0, "2014": 14.0, "2015": 10.5, "2016": 15.5, "2017": 7.5, "2018": 9.5, "2019": 9.0, "2020": 11.5, "2021": 16.0, "2022": 16.0, "2023": 17.0, "2024": 13.5}, "1": {"2010": 21.0, "2011": 19.5, "2012": 21.0, "2013": 24.0, "2014": 21.0, "2015": 22.0, "2016": 17.0, "2017": 18.0, "2018": 22.5, "2019": 21.0, "2020": 16.5, "2021": 25.5, "2022": 23.0, "2023": 19.0, "2024": 23.0}, "0": {"2010": 68.5, "2011": 70.5, "2012": 66.0, "2013": 61.0, "2014": 65.0, "2015": 67.5, "2016": 67.5, "2017": 74.5, "2018": 68.0, "2019": 70.0, "2020": 72.0, "2021": 58.0, "2022": 61.0, "2023": 64.0, "2024": 63.5}}, "1.3.1b_perceived_reference_stance": {"pro": {"2010": 11.0, "2011": 14.5, "2012": 16.5, "2013": 21.0, "2014": 15.5, "2015": 17.5, "2016": 17.0, "2017": 15.5, "2018": 10.5, "2019": 18.5, "2020": 18.5, "2021": 16.0, "2022": 12.5, "2023": 14.0, "2024": 15.0}, "against": {"2010": 2.5, "2011": 5.5, "2012": 2.0, "2013": 4.5, "2014": 4.5, "2015": 6.0, "2016": 7.5, "2017": 4.0, "2018": 4.0, "2019": 3.5, "2020": 8.5, "2021": 7.5, "2022": 4.0, "2023": 6.5, "2024": 5.5}, "neither/mixed": {"2010": 86.5, "2011": 80.0, "2012": 81.5, "2013": 74.5, "2014": 80.0, "2015": 76.5, "2016": 75.5, "2017": 80.5, "2018": 85.5, "2019": 78.0, "2020": 73.0, "2021": 76.5, "2022": 83.5, "2023": 79.5, "2024": 79.5}}}, "transport": {"1.2.1_descriptive": {"explicitly present": {"2010": 3.5, "2011": 9.9, "2012": 12.5, "2013": 17.0, "2014": 21.4, "2015": 12.0, "2016": 13.9, "2017": 12.7, "2018": 12.5, "2019": 11.5, "2020": 12.5, "2021": 11.8, "2022": 16.8, "2023": 11.6, "2024": 18.8}, "absent": {"2010": 96.5, "2011": 74.6, "2012": 71.0, "2013": 66.5, "2014": 63.7, "2015": 71.0, "2016": 75.2, "2017": 71.7, "2018": 78.4, "2019": 75.2, "2020": 76.8, "2021": 73.0, "2022": 68.7, "2023": 75.5, "2024": 69.2}, "unclear": {"2010": 0.0, "2011": 15.5, "2012": 16.5, "2013": 16.5, "2014": 14.9, "2015": 17.0, "2016": 10.9, "2017": 15.6, "2018": 9.1, "2019": 13.3, "2020": 10.7, "2021": 15.2, "2022": 14.5, "2023": 12.9, "2024": 12.0}}, "1.2.2_injunctive": {"present": {"2010": 1.8, "2011": 4.2, "2012": 4.5, "2013": 3.0, "2014": 8.0, "2015": 8.0, "2016": 5.9, "2017": 5.4, "2018": 2.9, "2019": 3.7, "2020": 6.2, "2021": 5.1, "2022": 6.1, "2023": 4.0, "2024": 3.8}, "absent": {"2010": 96.5, "2011": 95.8, "2012": 92.5, "2013": 96.5, "2014": 90.0, "2015": 89.5, "2016": 92.6, "2017": 94.1, "2018": 97.1, "2019": 95.9, "2020": 92.9, "2021": 92.4, "2022": 92.4, "2023": 94.4, "2024": 93.6}, "unclear": {"2010": 1.8, "2011": 0.0, "2012": 3.0, "2013": 0.5, "2014": 2.0, "2015": 2.5, "2016": 1.5, "2017": 0.5, "2018": 0.0, "2019": 0.5, "2020": 0.9, "2021": 2.5, "2022": 1.5, "2023": 1.6, "2024": 2.6}}, "1.3.3_second_order": {"2": {"2010": 1.8, "2011": 15.5, "2012": 12.5, "2013": 8.5, "2014": 13.4, "2015": 12.5, "2016": 11.4, "2017": 7.8, "2018": 6.2, "2019": 11.5, "2020": 10.7, "2021": 11.0, "2022": 13.0, "2023": 10.0, "2024": 10.2}, "1": {"2010": 8.8, "2011": 9.9, "2012": 15.0, "2013": 21.0, "2014": 15.9, "2015": 14.5, "2016": 13.4, "2017": 19.0, "2018": 13.9, "2019": 16.5, "2020": 12.9, "2021": 19.8, "2022": 19.1, "2023": 15.7, "2024": 14.7}, "0": {"2010": 89.5, "2011": 74.6, "2012": 72.5, "2013": 70.5, "2014": 70.6, "2015": 73.0, "2016": 75.2, "2017": 73.2, "2018": 79.8, "2019": 72.0, "2020": 76.3, "2021": 69.2, "2022": 67.9, "2023": 74.3, "2024": 75.2}}, "1.3.1b_perceived_reference_stance": {"pro": {"2010": 50.9, "2011": 31.0, "2012": 31.5, "2013": 29.5, "2014": 38.3, "2015": 31.5, "2016": 35.6, "2017": 29.8, "2018": 29.3, "2019": 27.5, "2020": 29.9, "2021": 21.9, "2022": 27.5, "2023": 19.7, "2024": 30.5}, "against": {"2010": 7.0, "2011": 12.7, "2012": 15.5, "2013": 11.5, "2014": 11.9, "2015": 8.5, "2016": 9.4, "2017": 8.3, "2018": 5.8, "2019": 12.4, "2020": 7.6, "2021": 13.9, "2022": 13.0, "2023": 17.3, "2024": 15.0}, "neither/mixed": {"2010": 42.1, "2011": 56.3, "2012": 53.0, "2013": 59.0, "2014": 49.8, "2015": 60.0, "2016": 55.0, "2017": 62.0, "2018": 64.9, "2019": 60.1, "2020": 62.5, "2021": 64.1, "2022": 59.5, "2023": 63.1, "2024": 54.5}}}, "housing": {"1.2.1_descriptive": {"explicitly present": {"2010": 4.7, "2011": 8.1, "2012": 7.5, "2013": 7.4, "2014": 12.4, "2015": 16.3, "2016": 8.1, "2017": 11.2, "2018": 15.0, "2019": 16.5, "2020": 11.4, "2021": 16.6, "2022": 19.2, "2023": 12.8, "2024": 19.8}, "absent": {"2010": 81.4, "2011": 71.9, "2012": 73.5, "2013": 73.9, "2014": 68.7, "2015": 63.5, "2016": 71.0, "2017": 63.6, "2018": 63.3, "2019": 58.3, "2020": 67.6, "2021": 58.1, "2022": 56.5, "2023": 66.7, "2024": 58.3}, "unclear": {"2010": 14.0, "2011": 20.0, "2012": 19.0, "2013": 18.7, "2014": 18.9, "2015": 20.2, "2016": 21.0, "2017": 25.2, "2018": 21.7, "2019": 25.2, "2020": 21.0, "2021": 25.3, "2022": 24.3, "2023": 20.6, "2024": 21.8}}, "1.2.2_injunctive": {"present": {"2010": 0.0, "2011": 1.9, "2012": 3.5, "2013": 7.4, "2014": 7.5, "2015": 6.4, "2016": 5.2, "2017": 7.8, "2018": 6.3, "2019": 7.8, "2020": 6.7, "2021": 8.3, "2022": 6.7, "2023": 8.6, "2024": 11.1}, "absent": {"2010": 93.0, "2011": 95.0, "2012": 96.0, "2013": 91.1, "2014": 91.5, "2015": 92.6, "2016": 92.9, "2017": 87.9, "2018": 92.8, "2019": 91.7, "2020": 90.5, "2021": 90.8, "2022": 90.0, "2023": 88.5, "2024": 87.3}, "unclear": {"2010": 7.0, "2011": 3.1, "2012": 0.5, "2013": 1.5, "2014": 1.0, "2015": 1.0, "2016": 1.9, "2017": 4.4, "2018": 1.0, "2019": 0.5, "2020": 2.9, "2021": 0.9, "2022": 3.3, "2023": 2.9, "2024": 1.6}}, "1.3.3_second_order": {"2": {"2010": 7.0, "2011": 6.2, "2012": 8.5, "2013": 16.7, "2014": 11.9, "2015": 13.8, "2016": 8.6, "2017": 12.6, "2018": 9.7, "2019": 16.0, "2020": 11.9, "2021": 12.0, "2022": 13.4, "2023": 14.4, "2024": 12.3}, "1": {"2010": 11.6, "2011": 8.8, "2012": 13.0, "2013": 17.7, "2014": 12.9, "2015": 18.2, "2016": 17.6, "2017": 18.4, "2018": 18.8, "2019": 18.4, "2020": 18.1, "2021": 23.0, "2022": 16.7, "2023": 21.0, "2024": 18.7}, "0": {"2010": 81.4, "2011": 85.0, "2012": 78.5, "2013": 65.5, "2014": 75.1, "2015": 68.0, "2016": 73.8, "2017": 68.9, "2018": 71.5, "2019": 65.5, "2020": 70.0, "2021": 65.0, "2022": 69.9, "2023": 64.6, "2024": 69.0}}, "1.3.1b_perceived_reference_stance": {"pro": {"2010": 37.2, "2011": 38.1, "2012": 31.5, "2013": 33.5, "2014": 33.3, "2015": 24.6, "2016": 25.7, "2017": 25.2, "2018": 27.5, "2019": 23.3, "2020": 23.3, "2021": 19.4, "2022": 23.4, "2023": 18.9, "2024": 29.4}, "against": {"2010": 16.3, "2011": 11.9, "2012": 12.5, "2013": 13.8, "2014": 11.4, "2015": 12.8, "2016": 10.5, "2017": 14.1, "2018": 9.2, "2019": 10.7, "2020": 13.3, "2021": 14.3, "2022": 10.0, "2023": 15.6, "2024": 10.7}, "neither/mixed": {"2010": 46.5, "2011": 50.0, "2012": 56.0, "2013": 52.7, "2014": 55.2, "2015": 62.6, "2016": 63.8, "2017": 60.7, "2018": 63.3, "2019": 66.0, "2020": 63.3, "2021": 66.4, "2022": 66.5, "2023": 65.4, "2024": 59.9}}}};
    var normDims={"1.2.1_descriptive": {"title": "Descriptive Norm", "cats": ["explicitly present", "absent", "unclear"], "colors": ["#7caed6", "#566a7a", "#8a9aa8"]}, "1.2.2_injunctive": {"title": "Injunctive Norm", "cats": ["present", "absent", "unclear"], "colors": ["#8fbfd9", "#566a7a", "#8a9aa8"]}, "1.3.3_second_order": {"title": "Second-Order Belief", "cats": ["2", "1", "0"], "display": ["strong", "weak", "none"], "colors": ["#b8a8c8", "#8fbfd9", "#8a9aa8"]}, "1.3.1b_perceived_reference_stance": {"title": "Perceived Stance", "cats": ["pro", "against", "neither/mixed"], "colors": ["#8fcc8f", "#ff9aa8", "#ffe87a"]}};
    var tSurvey={"food": {"diet_1": {"2010": 9.0, "2011": 9.0, "2012": 7.5, "2013": 10.0, "2014": 5.0, "2015": 5.5, "2016": 4.5, "2017": 6.0, "2018": 4.5, "2019": 8.5, "2020": 4.5, "2021": 4.0, "2022": 3.0, "2023": 4.5, "2024": 3.5}, "diet_2": {"2010": 20.5, "2011": 16.5, "2012": 19.5, "2013": 24.0, "2014": 20.0, "2015": 17.5, "2016": 21.5, "2017": 19.0, "2018": 20.5, "2019": 18.5, "2020": 21.5, "2021": 30.5, "2022": 19.5, "2023": 19.5, "2024": 24.0}, "diet_3": {"2010": 6.5, "2011": 1.5, "2012": 2.5, "2013": 7.0, "2014": 4.0, "2015": 5.0, "2016": 5.0, "2017": 5.0, "2018": 3.5, "2019": 7.0, "2020": 4.0, "2021": 7.0, "2022": 4.0, "2023": 4.0, "2024": 5.5}, "diet_4": {"2010": 3.5, "2011": 4.0, "2012": 7.0, "2013": 12.0, "2014": 8.5, "2015": 6.5, "2016": 7.0, "2017": 4.5, "2018": 8.0, "2019": 8.0, "2020": 5.5, "2021": 9.5, "2022": 6.5, "2023": 1.5, "2024": 7.0}, "diet_5": {"2010": 5.0, "2011": 1.0, "2012": 6.0, "2013": 8.5, "2014": 5.5, "2015": 5.0, "2016": 4.5, "2017": 5.0, "2018": 4.5, "2019": 8.0, "2020": 3.0, "2021": 4.5, "2022": 4.0, "2023": 2.5, "2024": 5.5}, "diet_6": {"2010": 3.5, "2011": 1.5, "2012": 4.0, "2013": 5.5, "2014": 4.5, "2015": 5.0, "2016": 2.0, "2017": 2.5, "2018": 2.0, "2019": 4.0, "2020": 1.5, "2021": 4.0, "2022": 3.0, "2023": 4.5, "2024": 4.5}, "diet_8": {"2010": 0.0, "2011": 0.0, "2012": 0.0, "2013": 0.5, "2014": 0.0, "2015": 0.0, "2016": 0.0, "2017": 0.0, "2018": 0.5, "2019": 0.5, "2020": 0.0, "2021": 1.5, "2022": 0.0, "2023": 0.0, "2024": 0.0}, "diet_9": {"2010": 7.0, "2011": 7.5, "2012": 9.0, "2013": 14.5, "2014": 9.5, "2015": 7.0, "2016": 9.5, "2017": 8.0, "2018": 9.0, "2019": 9.0, "2020": 10.0, "2021": 11.0, "2022": 9.0, "2023": 3.5, "2024": 7.0}, "diet_10": {"2010": 9.5, "2011": 8.5, "2012": 12.5, "2013": 15.0, "2014": 10.5, "2015": 11.0, "2016": 15.0, "2017": 9.0, "2018": 9.0, "2019": 10.5, "2020": 7.0, "2021": 9.0, "2022": 7.5, "2023": 7.0, "2024": 12.0}, "diet_11": {"2010": 1.5, "2011": 1.5, "2012": 3.5, "2013": 2.5, "2014": 2.0, "2015": 3.5, "2016": 2.5, "2017": 1.5, "2018": 1.0, "2019": 6.5, "2020": 3.5, "2021": 7.0, "2022": 1.5, "2023": 2.0, "2024": 0.5}, "diet_13": {"2010": 16.0, "2011": 13.0, "2012": 18.5, "2013": 21.0, "2014": 18.5, "2015": 17.5, "2016": 20.5, "2017": 15.5, "2018": 15.0, "2019": 19.0, "2020": 16.0, "2021": 22.5, "2022": 15.5, "2023": 10.0, "2024": 17.5}, "diet_14": {"2010": 6.0, "2011": 4.5, "2012": 7.5, "2013": 6.0, "2014": 7.5, "2015": 7.0, "2016": 6.0, "2017": 6.0, "2018": 6.5, "2019": 10.0, "2020": 7.0, "2021": 8.5, "2022": 8.5, "2023": 8.5, "2024": 5.0}, "diet_17": {"2010": 7.0, "2011": 2.5, "2012": 2.5, "2013": 3.0, "2014": 4.5, "2015": 5.5, "2016": 3.0, "2017": 1.0, "2018": 4.5, "2019": 4.5, "2020": 0.0, "2021": 6.5, "2022": 4.0, "2023": 4.5, "2024": 3.5}}, "transport": {"ev_1": {"2010": 10.5, "2011": 4.2, "2012": 7.5, "2013": 5.5, "2014": 7.0, "2015": 5.0, "2016": 6.9, "2017": 4.9, "2018": 4.8, "2019": 2.8, "2020": 4.5, "2021": 3.8, "2022": 4.6, "2023": 3.2, "2024": 3.0}, "ev_2": {"2010": 5.3, "2011": 5.6, "2012": 6.5, "2013": 7.0, "2014": 11.4, "2015": 7.5, "2016": 9.9, "2017": 10.2, "2018": 7.2, "2019": 7.8, "2020": 6.7, "2021": 9.3, "2022": 14.1, "2023": 6.8, "2024": 6.8}, "ev_3": {"2010": 3.5, "2011": 1.4, "2012": 2.5, "2013": 7.5, "2014": 4.0, "2015": 5.5, "2016": 5.9, "2017": 10.2, "2018": 4.3, "2019": 3.7, "2020": 5.4, "2021": 2.5, "2022": 6.5, "2023": 2.8, "2024": 2.3}, "ev_4": {"2010": 5.3, "2011": 0.0, "2012": 2.0, "2013": 5.5, "2014": 2.5, "2015": 3.0, "2016": 5.4, "2017": 6.8, "2018": 3.4, "2019": 2.3, "2020": 5.4, "2021": 3.4, "2022": 8.4, "2023": 4.4, "2024": 4.1}, "ev_5": {"2010": 1.8, "2011": 0.0, "2012": 4.0, "2013": 4.5, "2014": 5.0, "2015": 3.5, "2016": 4.0, "2017": 3.9, "2018": 5.3, "2019": 3.7, "2020": 7.1, "2021": 4.2, "2022": 4.6, "2023": 2.8, "2024": 3.0}, "ev_6": {"2010": 1.8, "2011": 1.4, "2012": 4.5, "2013": 5.5, "2014": 3.5, "2015": 6.5, "2016": 5.0, "2017": 4.4, "2018": 4.3, "2019": 6.0, "2020": 3.1, "2021": 4.6, "2022": 6.5, "2023": 6.4, "2024": 6.0}}, "housing": {"solar_1": {"2010": 11.6, "2011": 8.8, "2012": 10.0, "2013": 8.9, "2014": 8.5, "2015": 10.3, "2016": 10.0, "2017": 9.2, "2018": 8.7, "2019": 7.8, "2020": 10.0, "2021": 7.4, "2022": 14.6, "2023": 11.9, "2024": 12.7}, "solar_2": {"2010": 30.2, "2011": 25.6, "2012": 19.5, "2013": 22.2, "2014": 17.9, "2015": 14.3, "2016": 15.2, "2017": 21.8, "2018": 13.0, "2019": 11.7, "2020": 10.0, "2021": 10.6, "2022": 13.4, "2023": 12.3, "2024": 11.9}, "solar_3": {"2010": 0.0, "2011": 1.2, "2012": 1.5, "2013": 3.4, "2014": 4.0, "2015": 2.5, "2016": 3.8, "2017": 4.4, "2018": 3.4, "2019": 4.9, "2020": 5.2, "2021": 5.5, "2022": 5.9, "2023": 5.3, "2024": 6.3}, "solar_4": {"2010": 0.0, "2011": 1.2, "2012": 1.0, "2013": 3.9, "2014": 5.5, "2015": 5.4, "2016": 4.8, "2017": 6.3, "2018": 4.8, "2019": 3.9, "2020": 5.2, "2021": 6.5, "2022": 8.8, "2023": 11.5, "2024": 8.7}, "solar_5": {"2010": 0.0, "2011": 1.9, "2012": 3.5, "2013": 3.9, "2014": 3.5, "2015": 3.4, "2016": 1.4, "2017": 5.3, "2018": 3.9, "2019": 2.4, "2020": 4.3, "2021": 2.8, "2022": 5.9, "2023": 1.6, "2024": 4.4}, "solar_6": {"2010": 0.0, "2011": 1.9, "2012": 1.0, "2013": 2.5, "2014": 2.5, "2015": 2.0, "2016": 7.1, "2017": 6.3, "2018": 2.4, "2019": 5.3, "2020": 1.4, "2021": 5.5, "2022": 5.4, "2023": 4.9, "2024": 5.2}, "solar_7": {"2010": 0.0, "2011": 0.0, "2012": 0.5, "2013": 1.5, "2014": 0.5, "2015": 0.5, "2016": 1.9, "2017": 1.9, "2018": 1.4, "2019": 2.9, "2020": 0.5, "2021": 2.3, "2022": 1.7, "2023": 1.2, "2024": 2.4}, "solar_8": {"2010": 0.0, "2011": 0.0, "2012": 0.5, "2013": 0.5, "2014": 0.5, "2015": 0.5, "2016": 1.0, "2017": 1.0, "2018": 0.0, "2019": 0.5, "2020": 1.4, "2021": 0.5, "2022": 1.7, "2023": 1.6, "2024": 3.2}, "solar_9": {"2010": 0.0, "2011": 1.2, "2012": 1.0, "2013": 2.5, "2014": 1.5, "2015": 2.5, "2016": 3.8, "2017": 2.4, "2018": 1.9, "2019": 4.9, "2020": 3.8, "2021": 7.4, "2022": 7.1, "2023": 4.1, "2024": 6.0}, "solar_10": {"2010": 0.0, "2011": 0.6, "2012": 2.0, "2013": 3.9, "2014": 3.5, "2015": 3.9, "2016": 4.8, "2017": 9.2, "2018": 5.3, "2019": 7.3, "2020": 9.5, "2021": 7.8, "2022": 9.6, "2023": 9.9, "2024": 8.3}}};
    var surveyLabels={"diet_1": "Cite health as main reason for c...", "diet_2": "Protecting animals is 'moderatel...", "diet_3": "Helping to reduce global warming...", "diet_4": "Willing to eat more plant-based ...", "diet_5": "Willing to eat less red meat", "diet_6": "Willing to reduce dairy or use d...", "diet_8": "Willing to eat lab-grown meat (c...", "diet_9": "Taste is important for plant-bas...", "diet_10": "Convenience (ease/quick prep) is...", "diet_11": "Would switch if plant-based food...", "diet_13": "Nobody has ever asked them to ea...", "diet_14": "Barriers to plant-based eating (...", "diet_17": "Prefer meals with meat/dairy (id...", "ev_1": "Say EVs are better for the envir...", "ev_2": "Say EVs cost more up front", "ev_3": "Say EVs cost less to charge than...", "ev_4": "Extremely/very confident U.S. wi...", "ev_5": "Feel EVs are more fun to drive", "ev_6": "Believe EVs are more reliable th...", "solar_1": "View home solar panels as a majo...", "solar_2": "See solar as a way to help the e...", "solar_3": "Worry solar technology will beco...", "solar_4": "Believe it's difficult or imposs...", "solar_5": "Think local climate has insuffic...", "solar_6": "Have concerns about installer qu...", "solar_7": "Received inadequate post-install...", "solar_8": "Willing to pay for ongoing maint...", "solar_9": "Believe their system generates w...", "solar_10": "Lack confidence in using or unde..."};
    var surveyIds={"food": ["diet_1", "diet_2", "diet_3", "diet_4", "diet_5", "diet_6", "diet_8", "diet_9", "diet_10", "diet_11", "diet_13", "diet_14", "diet_17"], "transport": ["ev_1", "ev_2", "ev_3", "ev_4", "ev_5", "ev_6"], "housing": ["solar_1", "solar_2", "solar_3", "solar_4", "solar_5", "solar_6", "solar_7", "solar_8", "solar_9", "solar_10"]};

    var stanceCats=['pro','against','against particular but pro','neither/mixed','pro but lack of options'];
    var stanceColors={'pro':'#8fcc8f','against':'#ff9aa8','against particular but pro':'#ffb87a','neither/mixed':'#ffe87a','pro but lack of options':'#8fbfd9'};
    var stanceShort={'pro':'Pro','against':'Against','against particular but pro':'Against part.','neither/mixed':'Neither','pro but lack of options':'Pro (no opt.)'};

    // Helper: stacked area chart (proportions)
    function makeStackedArea(divId, years, catData, catNames, catColors, showLegend){
        var traces=[];
        catNames.forEach(function(cat,i){
            var yvals=years.map(function(y){return catData[cat]?catData[cat][y]||0:0});
            traces.push({x:years,y:yvals,name:cat,type:'scatter',mode:'lines',
                stackgroup:'one',line:{width:1.5,color:catColors[i]},
                marker:{color:catColors[i]},fillcolor:catColors[i].replace(')',',0.6)').replace('rgb','rgba'),
                showlegend:showLegend,
                hovertemplate:'<b>'+cat+'</b><br>%{x}: %{y:.1f}%<extra></extra>'
            });
        });
        Plotly.newPlot(divId,traces,Object.assign({},DL,{
            height:220,margin:{t:5,b:35,l:35,r:10},
            xaxis:{tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40',dtick:3},
            yaxis:{title:{text:'%',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40',range:[0,100]},
            legend:{font:{size:7,color:'#b0c4d8'},orientation:'h',y:-0.18,x:0.5,xanchor:'center'}
        }),PC);
    }

    // 1. Author Stance temporal (3 sectors)
    ['food','transport','housing'].forEach(function(sec,i){
        var catData=tStance[sec];
        var names=stanceCats.map(function(c){return stanceShort[c]||c});
        var colors=stanceCats.map(function(c){return stanceColors[c]});
        // Remap catData keys to short names
        var remapped={};
        stanceCats.forEach(function(c,ci){remapped[names[ci]]=catData[c]});
        makeStackedArea('temporal-stance-'+sec,YEARS,remapped,names,colors,i===2);
    });

    // 2. Norm Dimensions temporal (togglable)
    var currentDim='1.2.1_descriptive';
    function drawNormDim(dim){
        var meta=normDims[dim];
        var displayNames=meta.display||meta.cats;
        ['food','transport','housing'].forEach(function(sec,i){
            var divId='temporal-dim-'+sec;
            var catData=tNorms[sec][dim];
            // Remap to display names if provided
            var remapped={};
            meta.cats.forEach(function(c,ci){remapped[displayNames[ci]]=catData[c]});
            makeStackedArea(divId,YEARS,remapped,displayNames,meta.colors,i===2);
        });
    }
    drawNormDim(currentDim);
    window._setTemporalDim=function(dim){
        currentDim=dim;
        drawNormDim(dim);
        document.querySelectorAll('.temporal-dim-toggles .sankey-toggle').forEach(function(b){
            b.classList.toggle('active',b.dataset.dim===dim);
        });
    };

    // 3. Survey factors temporal (stacked per sector)
    var surveyColorPalette=['#5ab4ac','#af8dc3','#f4a460','#8fcc8f','#ff9aa8','#8fbfd9','#ffb87a','#c49fc4','#7cadc6','#ffe87a','#a8b8c2','#ffa8c2','#b8a8c8'];
    ['food','transport','housing'].forEach(function(sec,i){
        var qids=surveyIds[sec];
        var traces=[];
        qids.forEach(function(qid,qi){
            var yvals=YEARS.map(function(y){return tSurvey[sec][qid]?tSurvey[sec][qid][y]||0:0});
            var shortLabel=surveyLabels[qid]||qid;
            if(shortLabel.length>25) shortLabel=shortLabel.substring(0,22)+'...';
            traces.push({x:YEARS,y:yvals,name:shortLabel,type:'scatter',mode:'lines',
                stackgroup:'one',line:{width:1,color:surveyColorPalette[qi%surveyColorPalette.length]},
                showlegend:true,
                hovertemplate:'<b>'+(surveyLabels[qid]||qid)+'</b><br>%{x}: %{y:.1f}%<extra></extra>'
            });
        });
        Plotly.newPlot('temporal-survey-'+sec,traces,Object.assign({},DL,{
            height:320,margin:{t:5,b:35,l:35,r:10},
            xaxis:{tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40',dtick:3},
            yaxis:{title:{text:'% yes',font:{size:9,color:'#6a8caf'}},tickfont:{size:8,color:'#4a6a8a'},gridcolor:'#1a2a40'},
            legend:{font:{size:6,color:'#b0c4d8'},orientation:'v',y:1,x:1.02,xanchor:'left'}
        }),PC);
    });

    window._animateTemporal=function(){
        // Redraw all temporal charts
        ['food','transport','housing'].forEach(function(sec,i){
            var catData=tStance[sec];
            var names=stanceCats.map(function(c){return stanceShort[c]||c});
            var colors=stanceCats.map(function(c){return stanceColors[c]});
            var remapped={};stanceCats.forEach(function(c,ci){remapped[names[ci]]=catData[c]});
            makeStackedArea('temporal-stance-'+sec,YEARS,remapped,names,colors,i===2);
        });
        drawNormDim(currentDim);
    };
})();

window.addEventListener('load',function(){
    setTimeout(initBubbles,300);
    setTimeout(function(){if(window._animateNorms)window._animateNorms();},400);
});
</script>
</body>
</html>